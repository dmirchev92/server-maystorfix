"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[924],{4362:function(e,t,n){n.d(t,{H:function(){return r},a:function(){return c}});var o=n(7437),s=n(2265);let a=(0,s.createContext)(void 0);function r(e){let{children:t}=e,[n,r]=(0,s.useState)(null),[c,i]=(0,s.useState)(!0);(0,s.useEffect)(()=>{l()},[]);let l=async()=>{try{let n=localStorage.getItem("auth_token"),o=localStorage.getItem("user_data");if(console.log("\uD83D\uDD0D AuthContext - Checking auth status:",{hasToken:!!n,hasUserData:!!o,tokenPreview:n?n.substring(0,20)+"...":null}),n&&o)try{let s=JSON.parse(o);if("tradesperson"===s.role||"service_provider"===s.role)try{var e,t;console.log("\uD83D\uDDBC️ AuthContext - Fetching profile image for user:",s.id);let o=await fetch("".concat("https://maystorfix.com/api/v1","/marketplace/providers/").concat(s.id),{headers:{Authorization:"Bearer ".concat(n)}}),a=await o.json();console.log("\uD83D\uDDBC️ AuthContext - Profile data response:",a),console.log("\uD83D\uDDBC️ AuthContext - Profile image URL from API:",null===(e=a.data)||void 0===e?void 0:e.profileImageUrl),a.success&&(null===(t=a.data)||void 0===t?void 0:t.profileImageUrl)?(s.profileImageUrl=a.data.profileImageUrl,console.log("✅ AuthContext - Set profile image URL:",s.profileImageUrl),localStorage.setItem("user_data",JSON.stringify(s))):console.log("⚠️ AuthContext - No profile image URL in response")}catch(e){console.log("❌ AuthContext - Could not fetch profile image:",e)}r(s),console.log("✅ AuthContext - Loaded user from localStorage:",s)}catch(e){console.error("❌ AuthContext - Error parsing user data:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}else console.log("⚠️ AuthContext - No token or user data found")}catch(e){console.error("❌ AuthContext - Auth check error:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}finally{i(!1),console.log("✅ AuthContext - Auth check complete, isLoading set to false")}},u=async(e,t)=>{try{var n,o,s,a,c,l;console.log("\uD83D\uDD10 AuthContext - Starting login process...");let u=await fetch("".concat("https://maystorfix.com/api/v1","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),g=await u.json();if(console.log("\uD83D\uDD10 AuthContext - Login response:",g),g.success&&(null===(o=g.data)||void 0===o?void 0:null===(n=o.tokens)||void 0===n?void 0:n.accessToken)){console.log("✅ AuthContext - Login successful, updating state..."),localStorage.setItem("auth_token",g.data.tokens.accessToken),g.data.tokens.refreshToken&&localStorage.setItem("refresh_token",g.data.tokens.refreshToken);let e=g.data.user;if("tradesperson"===e.role||"service_provider"===e.role)try{console.log("\uD83D\uDDBC️ AuthContext - Fetching profile image after login for user:",e.id);let t=await fetch("".concat("https://maystorfix.com/api/v1","/marketplace/providers/").concat(e.id),{headers:{Authorization:"Bearer ".concat(g.data.tokens.accessToken)}}),n=await t.json();console.log("\uD83D\uDDBC️ AuthContext - Profile data after login:",n),console.log("\uD83D\uDDBC️ AuthContext - Profile image URL:",null===(s=n.data)||void 0===s?void 0:s.profileImageUrl),n.success&&(null===(a=n.data)||void 0===a?void 0:a.profileImageUrl)?(e.profileImageUrl=n.data.profileImageUrl,console.log("✅ AuthContext - Set profile image URL after login:",e.profileImageUrl)):console.log("⚠️ AuthContext - No profile image URL in response after login")}catch(e){console.log("❌ AuthContext - Could not fetch profile image after login:",e)}return localStorage.setItem("user_data",JSON.stringify(e)),r(e),i(!1),console.log("✅ AuthContext - User state updated:",e),window.dispatchEvent(new CustomEvent("auth-state-changed",{detail:{user:e,isAuthenticated:!0}})),{success:!0}}{console.error("❌ AuthContext - Login failed:",g);let e=(null===(c=g.error)||void 0===c?void 0:c.message)||"Login failed. Please check your credentials.",t=(null===(l=g.error)||void 0===l?void 0:l.details)||null;return console.log("\uD83D\uDD0D AuthContext - Error details:",{message:e,debugInfo:t}),{success:!1,error:e,debugInfo:t}}}catch(e){return console.error("❌ AuthContext - Login error:",e),{success:!1,error:"Network error. Please check your connection and try again."}}},g=async e=>{try{var t,n;let o=await fetch("".concat("https://maystorfix.com/api/v1","/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await o.json();if(s.success&&(null===(n=s.data)||void 0===n?void 0:null===(t=n.tokens)||void 0===t?void 0:t.accessToken))return localStorage.setItem("auth_token",s.data.tokens.accessToken),s.data.tokens.refreshToken&&localStorage.setItem("refresh_token",s.data.tokens.refreshToken),localStorage.setItem("user_data",JSON.stringify(s.data.user)),r(s.data.user),!0;return!1}catch(e){return console.error("Registration error:",e),!1}},h=(0,s.useCallback)(async()=>{try{var e;let t=localStorage.getItem("refresh_token");if(!t)return!1;let n=await fetch("".concat("https://maystorfix.com/api/v1","/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})}),o=await n.json();if(o.success&&(null===(e=o.data)||void 0===e?void 0:e.accessToken))return localStorage.setItem("auth_token",o.data.accessToken),o.data.refreshToken&&localStorage.setItem("refresh_token",o.data.refreshToken),!0;return!1}catch(e){return console.error("Token refresh error:",e),!1}},[]),d=()=>{localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_data"),r(null)};return(0,s.useEffect)(()=>{if(!n)return;let e=setInterval(async()=>{await h()||(console.log("Token refresh failed, logging out user"),d())},54e5);return()=>clearInterval(e)},[n,h]),(0,o.jsx)(a.Provider,{value:{user:n,isAuthenticated:!!n,isLoading:c,login:u,logout:d,register:g,refreshToken:h,updateUser:e=>{r(e),localStorage.setItem("user_data",JSON.stringify(e)),console.log("✅ AuthContext - User updated:",e)}},children:t})}function c(){let e=(0,s.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1837:function(e,t,n){n.d(t,{x:function(){return a}});var o=n(3464);class s{setupInterceptors(){this.client.interceptors.request.use(e=>{let t=this.getAuthToken();return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(this.clearAuthToken(),window.location.href="/auth/login"),Promise.reject(e)})}getAuthToken(){return localStorage.getItem("auth_token")}clearAuthToken(){localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_data")}async login(e,t){let{token:n,refreshToken:o,user:s}=(await this.client.post("/auth/login",{email:e,password:t})).data;return localStorage.setItem("auth_token",n),localStorage.setItem("refresh_token",o),{user:s,token:n,refreshToken:o}}async register(e){return this.client.post("/auth/register",e)}async logout(){return this.clearAuthToken(),this.client.post("/auth/logout")}async searchProviders(e){console.log("\uD83D\uDD0D API Client - Making request with filters:",e);try{let t=await this.client.get("/marketplace/providers/search",{params:e});return console.log("✅ API Client - Response received:",t),t}catch(e){throw console.error("❌ API Client - Request failed:",e),e}}async getProvider(e){return this.client.get("/marketplace/providers/".concat(e))}async validatePublicChat(e,t){return this.client.get("/chat/public/".concat(e,"/validate/").concat(t))}async createBooking(e){return this.client.post("/marketplace/bookings",e)}async getBookings(){return this.client.get("/marketplace/bookings")}async getConversations(){let e=JSON.parse(localStorage.getItem("user_data")||localStorage.getItem("user")||"{}");return"customer"===e.role?this.client.get("/chat/user/".concat(e.id,"/conversations")):this.client.get("/chat/provider/".concat(e.id,"/conversations"))}async getProfile(){return this.client.get("/auth/profile")}async updateProfile(e){return this.client.put("/auth/profile",e)}async getConsentStatus(){return this.client.get("/gdpr/consent-summary")}async updateConsent(e){return this.client.post("/gdpr/consent",e)}async startMarketplaceConversation(e){console.log("\uD83D\uDD17 API Client - Starting marketplace conversation:",e);let t={providerId:e.providerId,customerId:e.customerId,customerName:e.customerName,customerEmail:e.customerEmail,customerPhone:e.customerPhone||""};console.log("\uD83D\uDD17 API Client - Request payload:",JSON.stringify(t,null,2));try{let e=await this.client.post("/chat/conversations",t);return console.log("\uD83D\uDD17 API Client - Response:",e.data),e}catch(e){var n;throw console.error("\uD83D\uDD17 API Client - Error:",(null===(n=e.response)||void 0===n?void 0:n.data)||e.message),e}}async createOrGetConversation(e){return this.startMarketplaceConversation(e)}async startConversation(e){return this.startMarketplaceConversation(e)}async sendMarketplaceMessage(e){return console.log("\uD83D\uDCAC API Client - Sending marketplace message:",e.message.substring(0,50)+"..."),console.log("\uD83D\uDCAC API Client - Base URL:",this.client.defaults.baseURL),console.log("\uD83D\uDCAC API Client - Full URL would be:",this.client.defaults.baseURL+"/chat/messages"),this.client.post("/chat/messages",e)}async sendMessage(e){return this.sendMarketplaceMessage(e)}async getMarketplaceMessages(e,t){console.log("\uD83D\uDCD6 API Client - Getting marketplace messages for:",e),console.log("\uD83D\uDCD6 API Client - Base URL:",this.client.defaults.baseURL);let n="/chat/conversations/".concat(e,"/messages");return console.log("\uD83D\uDCD6 API Client - Request URL:",n),console.log("\uD83D\uDCD6 API Client - Full URL would be:",this.client.defaults.baseURL+n),this.client.get(n,{params:t?{limit:t}:{}})}async getConversationMessages(e,t){return this.getMarketplaceMessages(e,t)}async getMarketplaceConversation(e){return this.client.get("/chat/conversations/".concat(e))}async getConversationsV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Getting conversations"),this.client.get("/chat/conversations",{params:e})}async createConversationV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Creating conversation:",e),this.client.post("/chat/conversations",e)}async getConversationV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Getting conversation:",e),this.client.get("/chat/conversations/".concat(e))}async getMessagesV2(e,t){return console.log("\uD83D\uDCAC Chat API V2 - Getting messages for:",e),this.client.get("/chat/conversations/".concat(e,"/messages"),{params:t})}async sendMessageV2(e,t){return console.log("\uD83D\uDCAC Chat API V2 - Sending message to:",e),this.client.post("/chat/conversations/".concat(e,"/messages"),t)}async markConversationReadV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Marking conversation as read:",e),this.client.post("/chat/conversations/".concat(e,"/read"))}async editMessageV2(e,t){return console.log("\uD83D\uDCAC Chat API V2 - Editing message:",e),this.client.patch("/chat/messages/".concat(e),{body:t})}async deleteMessageV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Deleting message:",e),this.client.delete("/chat/messages/".concat(e))}async updateReceiptV2(e,t){return console.log("\uD83D\uDCAC Chat API V2 - Updating receipt for:",e,"to",t),this.client.post("/chat/messages/".concat(e,"/receipts"),{status:t})}async createCase(e){return console.log("\uD83D\uDCCB API Client - Creating case:",e),this.client.post("/cases",e)}async getCases(e){return console.log("\uD83D\uDCCB API Client - Getting cases with filters:",e),this.client.get("/cases",{params:e})}async getCase(e){return console.log("\uD83D\uDCCB API Client - Getting case:",e),this.client.get("/cases/".concat(e))}async assignCase(e,t,n){return(console.log("\uD83D\uDCCB API Client - Assigning case:",e,t),"accept"===t)?this.client.post("/cases/".concat(e,"/accept")):this.client.post("/cases/".concat(e,"/decline"),{reason:n})}async declineCase(e,t,n){return console.log("\uD83D\uDCCB API Client - Declining case:",e,"by provider:",t),this.client.post("/cases/".concat(e,"/decline"),{providerId:t,reason:n})}async getDeclinedCases(e){return console.log("\uD83D\uDEAB API Client - Getting declined cases for provider:",e),this.client.get("/cases/declined/".concat(e))}async undeclineCase(e,t){return console.log("✅ API Client - Un-declining case:",e,"for provider:",t),this.client.post("/cases/".concat(e,"/undecline"),{providerId:t})}async updateCaseStatus(e,t,n){return(console.log("\uD83D\uDCCB API Client - Updating case status:",e,t),"completed"===t||"closed"===t)?this.client.post("/cases/".concat(e,"/complete"),{completionNotes:n}):this.client.put("/cases/".concat(e,"/status"),{status:t,message:n})}async updateCaseStatusDirect(e,t,n){return console.log("\uD83D\uDCCB API Client - Direct status update:",e,t),this.client.put("/cases/".concat(e,"/status"),{status:t,message:n})}async getProviderCases(e,t){return console.log("\uD83D\uDCCB API Client - Getting provider cases:",e,t),this.client.get("/cases/provider/".concat(e),{params:t?{status:t}:{}})}async getAvailableCases(e,t){return console.log("\uD83D\uDCCB API Client - Getting available cases:",e,t),this.client.get("/cases/queue/".concat(e),{params:t})}async getProviderMarketplaceConversations(e){return this.client.get("/chat/provider/".concat(e,"/conversations"))}async markMarketplaceAsRead(e,t){return this.client.put("/chat/conversations/".concat(e,"/read"),{senderType:t})}async getCaseTemplate(e){return this.client.get("/cases/templates/".concat(e))}async createServiceCase(e){return this.client.post("/cases",e)}async updateServiceCase(e,t){return this.client.put("/cases/".concat(e),t)}async getServiceCaseByConversation(e){return this.client.get("/cases/conversation/".concat(e))}async getReferralDashboard(){return console.log("\uD83D\uDCCA API Client - Getting referral dashboard"),this.client.get("/referrals/dashboard")}async generateReferralCode(){return console.log("\uD83D\uDD17 API Client - Generating referral code"),this.client.post("/referrals/generate")}async trackReferralClick(e,t){return console.log("\uD83D\uDC46 API Client - Tracking referral click:",e),this.client.post("/referrals/track/".concat(e),t)}async getReferralStats(e){return console.log("\uD83D\uDCC8 API Client - Getting referral stats:",e),this.client.get("/referrals/stats/".concat(e))}async getReferredUsers(){return console.log("\uD83D\uDC65 API Client - Getting referred users"),this.client.get("/referrals/users")}async getReferralRewards(){return console.log("\uD83C\uDF81 API Client - Getting referral rewards"),this.client.get("/referrals/rewards")}async claimReferralReward(e){return console.log("\uD83C\uDFAF API Client - Claiming referral reward:",e),this.client.post("/referrals/rewards/".concat(e,"/claim"))}async getReferralLink(){return console.log("\uD83D\uDD17 API Client - Getting referral link"),this.client.get("/referrals/link")}async getCasesWithFilters(e){console.log("\uD83D\uDCCB API Client - Getting cases with filters:",e);let t=new URLSearchParams;return Object.entries(e).forEach(e=>{let[n,o]=e;null!=o&&t.append(n,o.toString())}),this.client.get("/cases?".concat(t.toString()))}async getCaseStats(e,t){console.log("\uD83D\uDCCA API Client - Getting case stats");let n=new URLSearchParams;return e&&n.append("providerId",e),t&&n.append("customerId",t),this.client.get("/cases/stats?".concat(n.toString()))}async acceptCase(e,t,n){return console.log("✅ API Client - Accepting case:",e),this.client.post("/cases/".concat(e,"/accept"),{providerId:t,providerName:n})}async completeCase(e,t,n){return console.log("\uD83C\uDFC1 API Client - Completing case:",e,"with income:",n),this.client.post("/cases/".concat(e,"/complete"),{completionNotes:t,income:n})}async getIncomeStats(e,t,n){console.log("\uD83D\uDCB0 API Client - Getting income stats for provider:",e);let o=new URLSearchParams;t&&o.append("startDate",t),n&&o.append("endDate",n);let s=o.toString()?"?".concat(o.toString()):"";return this.client.get("/income/provider/".concat(e).concat(s))}async getIncomeYears(e){return console.log("\uD83D\uDCC5 API Client - Getting income years for provider:",e),this.client.get("/income/provider/".concat(e,"/years"))}async getIncomeTransactionsByMethod(e,t){return console.log("\uD83D\uDCB0 API Client - Getting transactions for method:",t),this.client.get("/income/provider/".concat(e,"/method/").concat(encodeURIComponent(t)))}async getIncomeTransactionsByMonth(e,t){return console.log("\uD83D\uDCB0 API Client - Getting transactions for month:",t),this.client.get("/income/provider/".concat(e,"/month/").concat(t))}async updateIncomeTransaction(e,t){return console.log("\uD83D\uDCB0 API Client - Updating income transaction:",e),this.client.put("/income/".concat(e),t)}async getSmartMatches(e,t){return console.log("\uD83C\uDFAF API Client - Getting smart matches for case:",e),this.client.get("/cases/".concat(e,"/smart-matches").concat(t?"?limit=".concat(t):""))}async getUserNotifications(){return console.log("\uD83D\uDD14 API Client - Getting user notifications"),this.client.get("/notifications")}async getUnreadNotificationCount(){return console.log("\uD83D\uDD14 API Client - Getting unread notification count"),this.client.get("/notifications/unread-count")}async markNotificationAsRead(e){return console.log("\uD83D\uDD14 API Client - Marking notification as read:",e),this.client.post("/notifications/".concat(e,"/read"))}async markAllNotificationsAsRead(){return console.log("\uD83D\uDD14 API Client - Marking all notifications as read"),this.client.post("/notifications/mark-all-read")}async createReview(e){return console.log("⭐ API Client - Creating review:",e.caseId),this.client.post("/reviews",e)}async getProviderReviews(e,t,n){console.log("⭐ API Client - Getting provider reviews:",e);let o=new URLSearchParams;return t&&o.append("page",t.toString()),n&&o.append("limit",n.toString()),this.client.get("/reviews/provider/".concat(e,"?").concat(o.toString()))}async getProviderReviewStats(e){return console.log("\uD83D\uDCCA API Client - Getting provider review stats:",e),this.client.get("/reviews/provider/".concat(e,"/stats"))}async canReviewCase(e){return console.log("❓ API Client - Checking if can review case:",e),this.client.get("/reviews/case/".concat(e,"/can-review"))}async getPendingReviews(){return console.log("⏳ API Client - Getting pending reviews"),this.client.get("/reviews/pending")}constructor(){this.client=o.Z.create({baseURL:"https://maystorfix.com/api/v1",headers:{"Content-Type":"application/json"},timeout:1e4}),this.setupInterceptors()}}let a=new s;t.Z=a}}]);