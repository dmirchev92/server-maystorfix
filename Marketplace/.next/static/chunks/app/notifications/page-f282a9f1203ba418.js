(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[193],{3360:function(e,t,s){Promise.resolve().then(s.bind(s,3267))},3267:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(7437),r=s(2265),i=s(4362),n=s(9376),o=s(1837),l=s(1819);function c(){let{user:e,isAuthenticated:t,isLoading:s}=(0,i.a)(),c=(0,n.useRouter)(),[d,u]=(0,r.useState)([]),[m,x]=(0,r.useState)(!0),[h,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!s){if(!t){c.push("/auth/login");return}g()}},[t,s]);let g=async()=>{var t,s,a,r,i,n,l,c;try{x(!0),console.log("\uD83D\uDD14 Fetching notifications for user:",null==e?void 0:e.id);let a=await o.x.getUserNotifications();if(console.log("\uD83D\uDD14 Notifications API response:",a),null===(t=a.data)||void 0===t?void 0:t.success){let e=(null===(s=a.data.data)||void 0===s?void 0:s.notifications)||[];console.log("\uD83D\uDD14 Notifications data:",e);let t=[...e].sort((e,t)=>{let s=new Date(e.created_at).getTime();return new Date(t.created_at).getTime()-s});console.log("\uD83D\uDD14 Sorted notifications (newest first):",t.map(e=>({id:e.id.substring(0,8),created_at:e.created_at,title:e.title}))),u(t)}else console.error("\uD83D\uDD14 API returned unsuccessful response:",a.data),f("Грешка при зареждането на известията")}catch(e){console.error("\uD83D\uDD14 Error fetching notifications:",e),console.error("\uD83D\uDD14 Error details:",{message:e.message,status:null===(a=e.response)||void 0===a?void 0:a.status,statusText:null===(r=e.response)||void 0===r?void 0:r.statusText,data:null===(i=e.response)||void 0===i?void 0:i.data}),(null===(n=e.response)||void 0===n?void 0:n.status)===401||(null===(l=e.response)||void 0===l?void 0:l.status)===403?(console.log("\uD83D\uDD14 Authentication error detected, but not redirecting to avoid loop"),f("Сесията ви е изтекла. Моля влезте отново в профила си.")):(null===(c=e.response)||void 0===c?void 0:c.status)===404?(console.log("\uD83D\uDD14 Notifications endpoint not found, showing empty state"),u([])):f("Възникна грешка при зареждането на известията: ".concat(e.message))}finally{x(!1)}},p=async e=>{try{await o.x.markNotificationAsRead(e),u(t=>t.map(t=>t.id===e?{...t,read:!0}:t))}catch(e){console.error("Error marking notification as read:",e)}},v=async()=>{try{await o.x.markAllNotificationsAsRead(),u(e=>e.map(e=>({...e,read:!0})))}catch(e){console.error("Error marking all notifications as read:",e)}},D=async e=>{var t,s,a;if(e.read||await p(e.id),"case_completed"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.action)==="review_service"){let t=null===(s=e.data)||void 0===s?void 0:s.caseId;t&&c.push("/survey/".concat(t))}else if("case_assigned"===e.type){let t=null===(a=e.data)||void 0===a?void 0:a.caseId;t&&console.log("\uD83D\uDD14 Navigating to case:",t),c.push("/dashboard/cases")}else"case_accepted"===e.type?c.push("/dashboard"):"new_case_available"===e.type&&c.push("/dashboard?view=available")},b=e=>{switch(e){case"case_completed":return"\uD83C\uDF1F";case"case_assigned":return"\uD83D\uDCEC";case"case_accepted":return"✅";case"case_declined":return"❌";case"new_case_available":return"\uD83D\uDCCB";default:return"\uD83D\uDCE2"}},N=e=>{switch(e){case"case_completed":return"from-yellow-500/10 to-orange-500/10 border-yellow-400/30";case"case_assigned":return"from-indigo-500/10 to-purple-500/10 border-indigo-400/30";case"case_accepted":return"from-green-500/10 to-emerald-500/10 border-green-400/30";case"case_declined":return"from-red-500/10 to-pink-500/10 border-red-400/30";case"new_case_available":return"from-blue-500/10 to-indigo-500/10 border-blue-400/30";case"review_request":return"from-purple-500/10 to-violet-500/10 border-purple-400/30";default:return"from-slate-500/10 to-gray-500/10 border-slate-400/30"}},j=e=>{try{let t=new Date(e),s=new Date;if(isNaN(t.getTime()))return console.error("Invalid date:",e),"Невалидна дата";let a=t.toDateString()===s.toDateString(),r=t.getFullYear()===s.getFullYear();if(a)return t.toLocaleTimeString("bg-BG",{hour:"2-digit",minute:"2-digit",timeZone:"Europe/Sofia"});return t.toLocaleString("bg-BG",{day:"numeric",month:"short",year:r?void 0:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Sofia"})}catch(t){return console.error("Error formatting date:",t,e),"Невалидна дата"}};return s||m?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-white/30 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-slate-300",children:"Зареждане на известията..."})]})}):h?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"❌"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"Грешка"}),(0,a.jsx)("p",{className:"text-slate-300 mb-4",children:h}),(0,a.jsx)("button",{onClick:()=>g(),className:"bg-indigo-600/80 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors",children:"Опитай отново"})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900",children:[(0,a.jsx)(l.Header,{}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Известия"})}),d.some(e=>!e.read)&&(0,a.jsx)("button",{onClick:v,className:"text-indigo-400 hover:text-indigo-300 text-sm font-medium transition-colors",children:"Маркирай всички като прочетени"})]})}),0===d.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCED"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"Няма известия"}),(0,a.jsx)("p",{className:"text-slate-300",children:"Когато получите известия, те ще се появят тук."})]}):(0,a.jsx)("div",{className:"space-y-4",children:d.map(e=>(0,a.jsx)("div",{onClick:()=>D(e),className:"\n                  bg-gradient-to-r ".concat(N(e.type)," \n                  backdrop-blur-md border rounded-lg p-4 cursor-pointer transition-all duration-200 \n                  hover:shadow-xl hover:scale-[1.01]\n                  ").concat(e.read?"":"ring-2 ring-indigo-400/50","\n                "),children:(0,a.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-12 h-12 bg-white/20 border border-white/30 rounded-full flex items-center justify-center shadow-sm",children:(0,a.jsx)("span",{className:"text-2xl",children:b(e.type)})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white truncate",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:j(e.created_at)}),!e.read&&(0,a.jsx)("div",{className:"w-2 h-2 bg-indigo-400 rounded-full"})]})]}),(0,a.jsx)("p",{className:"text-slate-200 mt-1",children:e.message}),"case_completed"===e.type&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-500/20 text-yellow-300 border border-yellow-400/30",children:[(0,a.jsx)("span",{className:"mr-1",children:"⭐"}),"Натиснете за оценка"]})})]})]})},e.id))})]})]})}}},function(e){e.O(0,[301,648,137,924,819,971,117,744],function(){return e(e.s=3360)}),_N_E=e.O()}]);