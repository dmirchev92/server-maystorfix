(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{577:function(e,t,r){Promise.resolve().then(r.bind(r,1202))},9376:function(e,t,r){"use strict";var o=r(5475);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},1202:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var o=r(7437),s=r(2265),a=r(9376),l=r(7648),n=r(4362);function i(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),{login:r}=(0,n.a)(),[i,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)({email:"",password:"",rememberMe:!1});(0,s.useEffect)(()=>{t.get("registered");let e=localStorage.getItem("remember_email"),r=localStorage.getItem("remember_password");"1"===localStorage.getItem("remember_flag")&&(e||r)&&u(t=>({...t,email:e||"",password:r||"",rememberMe:!0}))},[t]);let m=(e,t)=>{u(r=>({...r,[e]:t}))},h=async t=>{if(t.preventDefault(),!d.email||!d.password){alert("Моля въведете имейл и парола");return}c(!0);try{console.log("\uD83D\uDD10 Attempting login with AuthContext...");let t=await r(d.email,d.password);if(t.success)console.log("✅ Login successful via AuthContext"),d.rememberMe?(localStorage.setItem("remember_email",d.email),localStorage.setItem("remember_password",d.password),localStorage.setItem("remember_flag","1")):localStorage.setItem("remember_flag","0"),alert("Успешен вход!"),setTimeout(()=>{e.push("/")},500);else{console.error("❌ Login failed via AuthContext");let e=t.error||"Login failed. Please check your credentials.";t.debugInfo&&console.log("\uD83D\uDD0D Login Debug Info:",t.debugInfo),alert(e)}}catch(e){console.error("❌ Login error:",e),alert("Възникна грешка при входа")}finally{c(!1)}};return(0,o.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 flex flex-col justify-center py-12 sm:px-6 lg:px-8 relative overflow-hidden",children:[(0,o.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,o.jsx)("div",{className:"absolute top-0 left-0 w-96 h-96 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 rounded-lg blur-3xl"}),(0,o.jsx)("div",{className:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-blue-500/10 to-slate-500/10 rounded-lg blur-3xl"}),(0,o.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-gradient-to-br from-slate-500/5 to-indigo-500/5 rounded-full blur-3xl"})]}),(0,o.jsxs)("div",{className:"relative z-10 sm:mx-auto sm:w-full sm:max-w-md",children:[(0,o.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,o.jsxs)("button",{onClick:()=>e.back(),className:"flex items-center text-slate-300 hover:text-white transition-colors",children:[(0,o.jsx)("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Назад"]})}),(0,o.jsx)("div",{className:"flex justify-center",children:(0,o.jsx)("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/50",children:(0,o.jsx)("span",{className:"text-3xl",children:"\uD83D\uDD27"})})}),(0,o.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white",children:"Влезте в акаунта си"}),(0,o.jsxs)("p",{className:"mt-2 text-center text-sm text-slate-300",children:["Или"," ",(0,o.jsx)(l.default,{href:"/auth/register",className:"font-medium text-indigo-400 hover:text-indigo-300 transition-colors",children:"създайте нов акаунт"})]}),"true"===t.get("registered")&&(0,o.jsx)("div",{className:"mt-4 bg-green-500/10 border border-green-500/30 rounded-lg p-4 backdrop-blur-sm",children:(0,o.jsxs)("div",{className:"flex",children:[(0,o.jsx)("div",{className:"flex-shrink-0",children:(0,o.jsx)("span",{className:"text-green-400",children:"✓"})}),(0,o.jsx)("div",{className:"ml-3",children:(0,o.jsx)("p",{className:"text-sm font-medium text-green-300",children:"Регистрацията е успешна! Моля влезте с вашите данни."})})]})})]}),(0,o.jsx)("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md relative z-20",children:(0,o.jsx)("div",{className:"bg-slate-800/50 backdrop-blur-md border border-white/10 rounded-2xl shadow-2xl p-8",children:(0,o.jsxs)("form",{className:"space-y-6",onSubmit:h,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-200",children:"Имейл адрес"}),(0,o.jsx)("div",{className:"mt-1",children:(0,o.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:d.email,onChange:e=>m("email",e.target.value),className:"w-full px-4 py-3 bg-slate-700/50 border border-white/10 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all",placeholder:"ivan@example.com"})})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-slate-200",children:"Парола"}),(0,o.jsx)("div",{className:"mt-1",children:(0,o.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:d.password,onChange:e=>m("password",e.target.value),className:"w-full px-4 py-3 bg-slate-700/50 border border-white/10 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all",placeholder:"••••••••"})})]}),(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("input",{id:"rememberMe",name:"rememberMe",type:"checkbox",checked:d.rememberMe,onChange:e=>m("rememberMe",e.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-slate-600 rounded bg-slate-700"}),(0,o.jsx)("label",{htmlFor:"rememberMe",className:"ml-2 block text-sm text-slate-300",children:"Запомни ме"})]}),(0,o.jsx)("div",{className:"text-sm",children:(0,o.jsx)("a",{href:"#",className:"font-medium text-indigo-400 hover:text-indigo-300 transition-colors",children:"Забравена парола?"})})]}),(0,o.jsx)("div",{children:(0,o.jsxs)("button",{type:"submit",disabled:i,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg shadow-indigo-500/50",children:[(0,o.jsx)("span",{className:"absolute left-0 inset-y-0 flex items-center pl-3",children:(0,o.jsx)("span",{className:"text-indigo-200 group-hover:text-indigo-100",children:"\uD83D\uDD13"})}),i?"Влизане...":"Влезте"]})}),(0,o.jsxs)("div",{className:"mt-6",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,o.jsx)("div",{className:"w-full border-t border-white/10"})}),(0,o.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,o.jsx)("span",{className:"px-2 bg-slate-800 text-slate-400",children:"Нов потребител?"})})]}),(0,o.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[(0,o.jsxs)(l.default,{href:"/auth/register?type=customer",className:"w-full inline-flex justify-center py-2 px-4 border border-white/20 rounded-lg shadow-sm bg-white/5 text-sm font-medium text-slate-300 hover:bg-white/10 hover:text-white transition-all backdrop-blur-sm",children:[(0,o.jsx)("span",{children:"\uD83D\uDC64"}),(0,o.jsx)("span",{className:"ml-2",children:"Клиент"})]}),(0,o.jsxs)(l.default,{href:"/auth/register?type=provider",className:"w-full inline-flex justify-center py-2 px-4 border border-white/20 rounded-lg shadow-sm bg-white/5 text-sm font-medium text-slate-300 hover:bg-white/10 hover:text-white transition-all backdrop-blur-sm",children:[(0,o.jsx)("span",{children:"\uD83D\uDD27"}),(0,o.jsx)("span",{className:"ml-2",children:"Доставчик"})]})]})]})]})})})]})}function c(){return(0,o.jsx)(s.Suspense,{fallback:(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}),children:(0,o.jsx)(i,{})})}},4362:function(e,t,r){"use strict";r.d(t,{H:function(){return l},a:function(){return n}});var o=r(7437),s=r(2265);let a=(0,s.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[n,i]=(0,s.useState)(!0);(0,s.useEffect)(()=>{c()},[]);let c=async()=>{try{let r=localStorage.getItem("auth_token"),o=localStorage.getItem("user_data");if(console.log("\uD83D\uDD0D AuthContext - Checking auth status:",{hasToken:!!r,hasUserData:!!o,tokenPreview:r?r.substring(0,20)+"...":null}),r&&o)try{let s=JSON.parse(o);if("tradesperson"===s.role||"service_provider"===s.role)try{var e,t;console.log("\uD83D\uDDBC️ AuthContext - Fetching profile image for user:",s.id);let o=await fetch("".concat("https://maystorfix.com/api/v1","/marketplace/providers/").concat(s.id),{headers:{Authorization:"Bearer ".concat(r)}}),a=await o.json();console.log("\uD83D\uDDBC️ AuthContext - Profile data response:",a),console.log("\uD83D\uDDBC️ AuthContext - Profile image URL from API:",null===(e=a.data)||void 0===e?void 0:e.profileImageUrl),a.success&&(null===(t=a.data)||void 0===t?void 0:t.profileImageUrl)?(s.profileImageUrl=a.data.profileImageUrl,console.log("✅ AuthContext - Set profile image URL:",s.profileImageUrl),localStorage.setItem("user_data",JSON.stringify(s))):console.log("⚠️ AuthContext - No profile image URL in response")}catch(e){console.log("❌ AuthContext - Could not fetch profile image:",e)}l(s),console.log("✅ AuthContext - Loaded user from localStorage:",s)}catch(e){console.error("❌ AuthContext - Error parsing user data:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}else console.log("⚠️ AuthContext - No token or user data found")}catch(e){console.error("❌ AuthContext - Auth check error:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}finally{i(!1),console.log("✅ AuthContext - Auth check complete, isLoading set to false")}},d=async(e,t)=>{try{var r,o,s,a,n,c;console.log("\uD83D\uDD10 AuthContext - Starting login process...");let d=await fetch("".concat("https://maystorfix.com/api/v1","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),u=await d.json();if(console.log("\uD83D\uDD10 AuthContext - Login response:",u),u.success&&(null===(o=u.data)||void 0===o?void 0:null===(r=o.tokens)||void 0===r?void 0:r.accessToken)){console.log("✅ AuthContext - Login successful, updating state..."),localStorage.setItem("auth_token",u.data.tokens.accessToken),u.data.tokens.refreshToken&&localStorage.setItem("refresh_token",u.data.tokens.refreshToken);let e=u.data.user;if("tradesperson"===e.role||"service_provider"===e.role)try{console.log("\uD83D\uDDBC️ AuthContext - Fetching profile image after login for user:",e.id);let t=await fetch("".concat("https://maystorfix.com/api/v1","/marketplace/providers/").concat(e.id),{headers:{Authorization:"Bearer ".concat(u.data.tokens.accessToken)}}),r=await t.json();console.log("\uD83D\uDDBC️ AuthContext - Profile data after login:",r),console.log("\uD83D\uDDBC️ AuthContext - Profile image URL:",null===(s=r.data)||void 0===s?void 0:s.profileImageUrl),r.success&&(null===(a=r.data)||void 0===a?void 0:a.profileImageUrl)?(e.profileImageUrl=r.data.profileImageUrl,console.log("✅ AuthContext - Set profile image URL after login:",e.profileImageUrl)):console.log("⚠️ AuthContext - No profile image URL in response after login")}catch(e){console.log("❌ AuthContext - Could not fetch profile image after login:",e)}return localStorage.setItem("user_data",JSON.stringify(e)),l(e),i(!1),console.log("✅ AuthContext - User state updated:",e),window.dispatchEvent(new CustomEvent("auth-state-changed",{detail:{user:e,isAuthenticated:!0}})),{success:!0}}{console.error("❌ AuthContext - Login failed:",u);let e=(null===(n=u.error)||void 0===n?void 0:n.message)||"Login failed. Please check your credentials.",t=(null===(c=u.error)||void 0===c?void 0:c.details)||null;return console.log("\uD83D\uDD0D AuthContext - Error details:",{message:e,debugInfo:t}),{success:!1,error:e,debugInfo:t}}}catch(e){return console.error("❌ AuthContext - Login error:",e),{success:!1,error:"Network error. Please check your connection and try again."}}},u=async e=>{try{var t,r;let o=await fetch("".concat("https://maystorfix.com/api/v1","/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await o.json();if(s.success&&(null===(r=s.data)||void 0===r?void 0:null===(t=r.tokens)||void 0===t?void 0:t.accessToken))return localStorage.setItem("auth_token",s.data.tokens.accessToken),s.data.tokens.refreshToken&&localStorage.setItem("refresh_token",s.data.tokens.refreshToken),localStorage.setItem("user_data",JSON.stringify(s.data.user)),l(s.data.user),!0;return!1}catch(e){return console.error("Registration error:",e),!1}},m=(0,s.useCallback)(async()=>{try{var e;let t=localStorage.getItem("refresh_token");if(!t)return!1;let r=await fetch("".concat("https://maystorfix.com/api/v1","/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})}),o=await r.json();if(o.success&&(null===(e=o.data)||void 0===e?void 0:e.accessToken))return localStorage.setItem("auth_token",o.data.accessToken),o.data.refreshToken&&localStorage.setItem("refresh_token",o.data.refreshToken),!0;return!1}catch(e){return console.error("Token refresh error:",e),!1}},[]),h=()=>{localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_data"),l(null)};return(0,s.useEffect)(()=>{if(!r)return;let e=setInterval(async()=>{await m()||(console.log("Token refresh failed, logging out user"),h())},54e5);return()=>clearInterval(e)},[r,m]),(0,o.jsx)(a.Provider,{value:{user:r,isAuthenticated:!!r,isLoading:n,login:d,logout:h,register:u,refreshToken:m,updateUser:e=>{l(e),localStorage.setItem("user_data",JSON.stringify(e)),console.log("✅ AuthContext - User updated:",e)}},children:t})}function n(){let e=(0,s.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[648,971,117,744],function(){return e(e.s=577)}),_N_E=e.O()}]);