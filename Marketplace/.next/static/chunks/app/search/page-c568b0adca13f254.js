(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{5289:function(e,r,s){Promise.resolve().then(s.bind(s,6314))},6314:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return h},dynamic:function(){return m}});var t=s(7437),i=s(2265),l=s(9376),a=s(4362),o=s(1819),n=s(5533),d=s(2834),c=s(1837),u=s(3659);let m="force-dynamic";function h(){let e=(0,l.useSearchParams)(),r=(0,l.useRouter)(),{user:m}=(0,a.a)(),[h,p]=(0,i.useState)([]),[v,x]=(0,i.useState)(!0),[g,b]=(0,i.useState)(null),[f,j]=(0,i.useState)(!1),[N,y]=(0,i.useState)(null),[w,D]=(0,i.useState)(0),[_,C]=(0,i.useState)(null),[k,S]=(0,i.useState)(!1),I=e.get("category"),E=e.get("city"),P=e.get("neighborhood"),[F,R]=(0,i.useState)({category:I||"",city:E||"",neighborhood:P||""});(0,i.useEffect)(()=>{R({category:I||"",city:E||"",neighborhood:P||""})},[I,E,P]),(0,i.useEffect)(()=>{(async()=>{try{var e;x(!0),b(null);let r={};I&&(r.category=I),E&&(r.city=E),P&&(r.neighborhood=P),console.log("\uD83D\uDD0D Searching with filters:",r);let s=await c.x.searchProviders(r);console.log("\uD83D\uDD0D Full API response:",s),console.log("\uD83D\uDD0D Response data:",s.data);let t=null===(e=s.data)||void 0===e?void 0:e.data;console.log("\uD83D\uDD0D Providers array:",t),Array.isArray(t)?(console.log("✅ Setting providers:",t.length,"items"),p(t)):(console.log("❌ No providers found in response, setting empty array"),p([]))}catch(e){console.error("❌ Error fetching providers:",e),b("Failed to load service providers. Please try again.")}finally{x(!1)}})()},[I,E,P]),(0,i.useEffect)(()=>{(async()=>{try{let{marketplaceSocket:e}=await Promise.all([s.e(680),s.e(549)]).then(s.bind(s,4549));C(e);let r=()=>{S((null==e?void 0:e.getConnectionStatus())||!1)};r();let t=setInterval(r,1e3);return()=>clearInterval(t)}catch(e){console.error("Failed to load socket service:",e)}})()},[]),(0,i.useEffect)(()=>{if(!_){console.log("⚠️ Socket service not available yet");return}return console.log("\uD83D\uDD0C Setting up real-time provider updates..."),_.onProviderProfileUpdated(e=>{console.log("\uD83D\uDCE1 Provider profile updated:",e.providerId,e.provider),p(r=>{let s=[...r],t=s.findIndex(r=>r.id===e.providerId);if(t>=0){let r={...s[t],business_name:e.provider.business_name,service_category:e.provider.service_category,description:e.provider.description,experience_years:e.provider.experience_years,hourly_rate:e.provider.hourly_rate,city:e.provider.city,neighborhood:e.provider.neighborhood,phone_number:e.provider.phone_number,email:e.provider.email,first_name:e.provider.first_name,last_name:e.provider.last_name,rating:e.provider.rating||0,total_reviews:e.provider.total_reviews||0};s[t]=r,console.log("✅ Updated existing provider in list:",e.providerId)}else if((!I||e.provider.service_category===I)&&(!E||e.provider.city===E)&&(!P||e.provider.neighborhood===P)){let r={id:e.provider.id,business_name:e.provider.business_name,service_category:e.provider.service_category,description:e.provider.description,experience_years:e.provider.experience_years,hourly_rate:e.provider.hourly_rate,city:e.provider.city,neighborhood:e.provider.neighborhood,phone_number:e.provider.phone_number,email:e.provider.email,first_name:e.provider.first_name,last_name:e.provider.last_name,rating:e.provider.rating||0,total_reviews:e.provider.total_reviews||0};s.unshift(r),console.log("✅ Added new provider to list:",e.providerId)}return s}),D(e=>e+1)}),E&&_.joinLocationRoom(E,P||void 0),I&&_.joinCategoryRoom(I),()=>{console.log("\uD83E\uDDF9 Cleaning up real-time listeners..."),_.offProviderProfileUpdated(),E&&_.leaveLocationRoom(E,P||void 0),I&&_.leaveCategoryRoom(I)}},[_,I,E,P]);let A=e=>({electrician:"Електротехник",plumber:"Водопроводчик",hvac:"Климатик",carpenter:"Дърводелец",painter:"Бояджия",locksmith:"Ключар",cleaner:"Почистване",gardener:"Градинар",handyman:"Майстор за всичко",appliance_repair:"Ремонт на уреди"})[e]||e,U=e=>{let r=[],s=Math.floor(e);for(let e=0;e<s;e++)r.push("⭐");for(e%1!=0&&r.push("⭐");r.length<5;)r.push("☆");return r.join("")},O=async e=>{try{var s,t,i,l;let a=e.business_name||e.businessName,o=e.first_name||e.firstName,n=e.last_name||e.lastName;a||"".concat(o||""," ").concat(n||"").trim();let d=await c.x.createOrGetConversation({providerId:e.id,customerId:null==m?void 0:m.id,customerName:(null==m?void 0:m.firstName)+" "+(null==m?void 0:m.lastName)||"Customer",customerEmail:(null==m?void 0:m.email)||"",customerPhone:(null==m?void 0:m.phoneNumber)||""});if(console.log("\uD83D\uDD17 Conversation response:",d.data),null===(s=d.data)||void 0===s?void 0:s.success){let e=(null===(i=d.data.data)||void 0===i?void 0:null===(t=i.conversation)||void 0===t?void 0:t.id)||(null===(l=d.data.data)||void 0===l?void 0:l.conversationId);e?r.push("/chat?conversation=".concat(e)):(console.error("No conversation ID in response:",d.data),r.push("/chat"))}else r.push("/chat")}catch(e){console.error("Error creating conversation:",e),r.push("/chat")}},T=e=>{console.log("Selected provider for case creation:",e),console.log("Provider category:",e.serviceCategory||e.service_category),y(e),j(!0)},L=async e=>{try{var r,s;let t={...e,customerId:null==m?void 0:m.id,providerId:"specific"===e.assignmentType?null==N?void 0:N.id:null,providerName:"specific"===e.assignmentType?(null==N?void 0:N.businessName)||(null==N?void 0:N.business_name)||"".concat((null==N?void 0:N.first_name)||""," ").concat((null==N?void 0:N.last_name)||"").trim()||"Специалист":null,isOpenCase:"open"===e.assignmentType};console.log("Creating case with data:",t);let i=await c.x.createCase(t);if(null===(r=i.data)||void 0===r?void 0:r.success){j(!1),y(null);let r="specific"===e.assignmentType?"Заявката е изпратена директно към ".concat((null==N?void 0:N.businessName)||(null==N?void 0:N.business_name)||(null==N?void 0:N.first_name)||"специалиста","! Ще получите потвърждение скоро."):"Заявката е създадена и е достъпна за всички специалисти! Ще получите потвърждение скоро.";alert(r)}else throw Error((null===(s=i.data)||void 0===s?void 0:s.message)||"Failed to create case")}catch(e){console.error("Error creating case:",e),alert("Възникна грешка при създаването на заявката. Моля, опитайте отново.")}},z=e=>{R(e);let s=new URLSearchParams;e.category&&s.append("category",e.category),e.city&&s.append("city",e.city),e.neighborhood&&s.append("neighborhood",e.neighborhood),r.push("/search?".concat(s.toString()))};return(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 relative overflow-hidden",children:[(0,t.jsxs)("div",{className:"absolute inset-0",children:[(0,t.jsx)("div",{className:"absolute top-0 left-0 w-96 h-96 bg-gradient-to-br from-indigo-500/10 to-slate-500/10 rounded-lg blur-3xl"}),(0,t.jsx)("div",{className:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500/10 to-slate-500/10 rounded-lg blur-3xl"})]}),(0,t.jsx)(o.Header,{}),(0,t.jsxs)("main",{className:"relative z-10 container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8 bg-white/10 backdrop-blur-md rounded-xl p-6 shadow-xl border border-white/20",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white text-lg",children:"\uD83D\uDD0D"})}),(0,t.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Намерени Услуги"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(k?"bg-green-500":"bg-red-500")}),(0,t.jsx)("span",{className:"text-sm text-slate-300",children:k?"Актуални данни":"Без връзка"}),w>0&&(0,t.jsxs)("span",{className:"bg-indigo-500/20 text-indigo-300 text-xs px-2 py-1 rounded-full border border-indigo-400/30",children:[w," обновления"]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 text-sm",children:[I&&(0,t.jsxs)("span",{className:"bg-indigo-500/20 text-indigo-300 px-3 py-1 rounded-full border border-indigo-400/30",children:["\uD83D\uDCCB ",A(I)]}),E&&(0,t.jsxs)("span",{className:"bg-green-500/20 text-green-300 px-3 py-1 rounded-full border border-green-400/30",children:["\uD83C\uDFD9️ ",E]}),P&&(0,t.jsxs)("span",{className:"bg-purple-500/20 text-purple-300 px-3 py-1 rounded-full border border-purple-400/30",children:["\uD83D\uDCCD ",P]})]})]}),(0,t.jsxs)("div",{className:"mb-8 bg-white/10 backdrop-blur-md rounded-xl p-6 shadow-xl border border-white/20",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"Филтри за търсене"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"Тип услуга"}),(0,t.jsxs)("select",{value:F.category,onChange:e=>z({...F,category:e.target.value}),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,t.jsx)("option",{value:"",children:"Всички услуги"}),[{value:"electrician",label:"Електротехник"},{value:"plumber",label:"Водопроводчик"},{value:"hvac",label:"Климатик"},{value:"carpenter",label:"Дърводелец"},{value:"painter",label:"Бояджия"},{value:"locksmith",label:"Ключар"},{value:"cleaner",label:"Почистване"},{value:"gardener",label:"Градинар"},{value:"handyman",label:"Майстор за всичко"},{value:"appliance_repair",label:"Ремонт на уреди"}].map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"Град"}),(0,t.jsxs)("select",{value:F.city,onChange:e=>z({...F,city:e.target.value,neighborhood:""}),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,t.jsx)("option",{value:"",children:"Изберете град"}),[{value:"София",label:"София"},{value:"Пловдив",label:"Пловдив"},{value:"Варна",label:"Варна"},{value:"Бургас",label:"Бургас"}].map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),"София"===F.city&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"Квартал"}),(0,t.jsxs)("select",{value:F.neighborhood,onChange:e=>z({...F,neighborhood:e.target.value}),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,t.jsx)("option",{value:"",children:"Всички квартали"}),u.vp.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]})]})]}),v&&(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white/30 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-slate-300",children:"Зареждане на услуги..."})]}),g&&(0,t.jsxs)("div",{className:"bg-red-500/10 border border-red-400/30 rounded-lg p-6 text-center backdrop-blur-sm",children:[(0,t.jsxs)("p",{className:"text-red-300",children:["❌ ",g]}),(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 bg-red-600/80 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors",children:"Опитай отново"})]}),!v&&!g&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mb-6 bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-indigo-400",children:"\uD83D\uDCCA"}),(0,t.jsxs)("p",{className:"text-white font-semibold",children:["Намерени ",h.length," ",1===h.length?"услуга":"услуги"]})]})}),0===h.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Няма намерени услуги"}),(0,t.jsx)("p",{className:"text-slate-300 mb-6",children:"Опитайте с различни критерии за търсене"}),(0,t.jsx)("a",{href:"/",className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition-all duration-300",children:"Върни се към началото"})]}):(0,t.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:h.map(e=>{var r,s;return(0,t.jsx)("div",{className:"bg-white/10 backdrop-blur-md rounded-xl shadow-xl overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:scale-105 border border-white/20",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[e.profileImageUrl?(0,t.jsx)("img",{src:e.profileImageUrl,alt:e.businessName,className:"w-12 h-12 rounded-full object-cover border-2 border-white/30"}):(0,t.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 border-2 border-white/30 rounded-full flex items-center justify-center",children:(0,t.jsxs)("span",{className:"text-white text-sm font-bold",children:[null===(r=e.firstName)||void 0===r?void 0:r.charAt(0),null===(s=e.lastName)||void 0===s?void 0:s.charAt(0)]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-white",children:e.businessName}),(0,t.jsxs)("p",{className:"text-sm text-slate-300 font-medium",children:[e.firstName," ",e.lastName]})]})]})}),(0,t.jsx)("span",{className:"bg-gradient-to-r from-indigo-500/20 to-purple-500/20 text-indigo-300 text-xs px-3 py-1 rounded-full font-semibold border border-indigo-400/30",children:A(e.serviceCategory||e.service_category)})]}),(0,t.jsxs)("div",{className:"flex items-center mb-4 p-2 bg-white/10 rounded-lg",children:[(0,t.jsx)("span",{className:"text-lg mr-2",children:U(e.rating||0)}),(0,t.jsxs)("span",{className:"text-sm text-slate-200 font-semibold",children:[Number(e.rating||0).toFixed(1)," (",e.totalReviews||e.total_reviews||0," отзива)"]})]}),(0,t.jsx)("p",{className:"text-slate-200 text-sm mb-4 line-clamp-3 bg-white/5 p-3 rounded-lg italic",children:e.description||"Професионални услуги с качество и гаранция."}),(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center text-sm text-slate-300",children:[(0,t.jsx)("span",{className:"mr-2",children:"\uD83D\uDCCD"}),(0,t.jsxs)("span",{children:[e.city,", ",e.neighborhood]})]}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-slate-300",children:[(0,t.jsx)("span",{className:"mr-2",children:"⭐"}),(0,t.jsxs)("span",{children:[e.experienceYears," години опит"]})]}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-slate-300",children:[(0,t.jsx)("span",{className:"mr-2",children:"\uD83D\uDCDE"}),(0,t.jsx)("span",{children:e.phoneNumber})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("a",{href:"/provider/".concat(e.id),className:"flex-1 bg-white/20 text-white text-center py-2 px-4 rounded-md hover:bg-white/30 transition-colors text-sm font-medium border border-white/30",children:"Виж повече"}),(null==m?void 0:m.id)!==e.id&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>T(e),className:"bg-purple-600/80 text-white py-2 px-4 rounded-md hover:bg-purple-600 transition-colors text-sm font-medium",children:"Заявка"}),(0,t.jsx)("button",{onClick:()=>O(e),className:"bg-indigo-600/80 text-white py-2 px-4 rounded-md hover:bg-indigo-600 transition-colors text-sm font-medium",children:"Чат"})]})]})]})},e.id)})})]}),(0,t.jsx)("div",{className:"text-center mt-12",children:(0,t.jsxs)("a",{href:"/",className:"inline-flex items-center gap-2 bg-gradient-to-r from-slate-600 to-blue-600 text-white px-6 py-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition-all duration-300 font-medium",children:[(0,t.jsx)("span",{children:"\uD83C\uDFE0"}),"Върни се към началото"]})})]}),(0,t.jsx)(d.$,{}),N&&(0,t.jsx)(n.Z,{isOpen:f,onClose:()=>{j(!1),y(null)},onSubmit:L,providerName:N.businessName||N.business_name||"".concat(N.first_name||""," ").concat(N.last_name||"").trim()||"Специалист",providerId:N.id,providerCategory:N.serviceCategory||N.service_category,customerPhone:(null==m?void 0:m.phoneNumber)||"",mode:"direct"})]})}}},function(e){e.O(0,[301,648,137,924,819,274,971,117,744],function(){return e(e.s=5289)}),_N_E=e.O()}]);