(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[696],{3338:function(e,s,t){Promise.resolve().then(t.bind(t,5250))},5250:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var a=t(7437),r=t(2265),l=t(4362),i=t(9376),n=t(1837),o=t(757),d=t(6334),c=t(8711),u=t(337),x=t(1819);function h(e){let{isOpen:s,onClose:t,onComplete:l,caseTitle:i}=e,[n,o]=(0,r.useState)(""),[d,c]=(0,r.useState)(!1),[u,x]=(0,r.useState)(""),[h,m]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[b,v]=(0,r.useState)(!1),f=async e=>{e.preventDefault(),v(!0);try{let e={completionNotes:n};d&&u&&parseFloat(u)>0&&(e.income={amount:parseFloat(u),paymentMethod:h||void 0,notes:p||void 0}),await l(e),o(""),c(!1),x(""),m(""),g("")}catch(e){console.error("Error completing case:",e)}finally{v(!1)}};return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 rounded-t-lg",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\uD83C\uDFC1 Завършване на заявка"}),(0,a.jsx)("p",{className:"text-green-50 mt-1",children:i})]}),(0,a.jsxs)("form",{onSubmit:f,className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Бележки за завършване"}),(0,a.jsx)("textarea",{value:n,onChange:e=>o(e.target.value),placeholder:"Опишете какво е направено...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",rows:3})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("input",{type:"checkbox",id:"includeIncome",checked:d,onChange:e=>c(e.target.checked),className:"mt-1 h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),(0,a.jsxs)("label",{htmlFor:"includeIncome",className:"ml-3 flex-1",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"\uD83D\uDCB0 Добави приход от тази заявка"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Проследявайте приходите си за по-добро управление на бизнеса"})]})]})}),d&&(0,a.jsxs)("div",{className:"space-y-4 pl-7 border-l-4 border-green-500",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Сума ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",value:u,onChange:e=>x(e.target.value),placeholder:"0.00",required:d,className:"w-full px-4 py-2 pr-16 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"}),(0,a.jsx)("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"BGN"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Метод на плащане"}),(0,a.jsxs)("select",{value:h,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Изберете метод"}),(0,a.jsx)("option",{value:"cash",children:"\uD83D\uDCB5 Кеш"}),(0,a.jsx)("option",{value:"card",children:"\uD83D\uDCB3 Картово плащане"}),(0,a.jsx)("option",{value:"bank_transfer",children:"\uD83C\uDFE6 Банков път"}),(0,a.jsx)("option",{value:"online",children:"\uD83C\uDF10 Revolut"}),(0,a.jsx)("option",{value:"other",children:"\uD83D\uDCDD Друго"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Допълнителни бележки"}),(0,a.jsx)("textarea",{value:p,onChange:e=>g(e.target.value),placeholder:"Напр. частично плащане, бонус и т.н...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",rows:2})]})]}),(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-800",children:[(0,a.jsx)("strong",{children:"\uD83D\uDCA1 Съвет:"})," Добавянето на приход ви помага да проследявате месечните си приходи и да анализирате бизнеса си по-добре."]})}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:t,disabled:b,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Отказ"}),(0,a.jsx)("button",{type:"submit",disabled:b||d&&(!u||0>=parseFloat(u)),className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:b?"⏳ Завършване...":"✅ Завърши заявката"})]})]})]})}):null}var m=t(3659);function p(){let{user:e,isAuthenticated:s,isLoading:t,logout:p}=(0,l.a)(),g=(0,i.useRouter)(),[b,v]=(0,r.useState)([]),[f,j]=(0,r.useState)(!0),[D,w]=(0,r.useState)(null),[N,y]=(0,r.useState)(new Set),[C,k]=(0,r.useState)({status:"",category:"",city:"",neighborhood:"",viewMode:"available",page:1,limit:10}),[E,_]=(0,r.useState)({isOpen:!1,caseId:"",caseTitle:""}),F=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(!t&&!s){g.push("/auth/login");return}if(!t&&s&&e&&"service_provider"!==e.role&&"tradesperson"!==e.role){console.log("❌ User is not a service provider, redirecting to home. Role:",e.role),g.push("/");return}},[s,t,e,g]),(0,r.useEffect)(()=>{s&&e&&(I(),S())},[s,null==e?void 0:e.id,C.status,C.category,C.city,C.neighborhood,C.viewMode,C.page]);let I=async()=>{if(F.current){console.log("⏭️ Skipping duplicate fetchCases request");return}try{var s,t;F.current=!0,j(!0);let a={status:C.status,category:C.category,city:C.city,neighborhood:C.neighborhood,page:C.page,limit:C.limit};if((null==e?void 0:e.role)==="tradesperson"||(null==e?void 0:e.role)==="service_provider"){if("assigned"===C.viewMode)a.providerId=e.id;else if("declined"===C.viewMode){let s=await n.x.getDeclinedCases(e.id);if(console.log("\uD83D\uDEAB Dashboard - Declined cases response:",s.data),null===(t=s.data)||void 0===t?void 0:t.success){let e=s.data.data||[];console.log("\uD83D\uDEAB Dashboard - Declined cases found:",e.length,e),v(e)}else console.error("\uD83D\uDEAB Dashboard - API response not successful:",s.data),v([]);return}else a.onlyUnassigned="true",a.excludeDeclinedBy=e.id}else a.customerId=null==e?void 0:e.id;console.log("\uD83D\uDD0D Dashboard - User:",e),console.log("\uD83D\uDD0D Dashboard - Filter params:",a);let r=await n.x.getCasesWithFilters(a);if(console.log("\uD83D\uDD0D Dashboard - API response:",r.data),null===(s=r.data)||void 0===s?void 0:s.success){let e=r.data.data.cases||[];console.log("\uD83D\uDD0D Dashboard - Cases found:",e.length,e),e.forEach((e,s)=>{var t;console.log("\uD83D\uDD0D Dashboard - Case ".concat(s+1,": ID=").concat(e.id,', Status="').concat(e.status,'", Title="').concat(e.title||(null===(t=e.description)||void 0===t?void 0:t.substring(0,30)),'"'))}),v(e)}else console.error("\uD83D\uDD0D Dashboard - API response not successful:",r.data),v([])}catch(e){console.error("Error fetching cases:",e)}finally{j(!1),F.current=!1}},S=async()=>{try{var s;let t=await n.x.getCaseStats((null==e?void 0:e.role)==="tradesperson"||(null==e?void 0:e.role)==="service_provider"?e.id:void 0);(null===(s=t.data)||void 0===s?void 0:s.success)&&w(t.data.data)}catch(e){console.error("Error fetching stats:",e)}},M=async e=>{try{var s;let t=await n.x.completeCase(E.caseId,e.completionNotes,e.income);(null===(s=t.data)||void 0===s?void 0:s.success)&&(alert("Заявката беше завършена успешно!"),_({isOpen:!1,caseId:"",caseTitle:""}),setTimeout(()=>{I(),S()},500))}catch(e){console.error("Error completing case:",e),alert("Възникна грешка при завършването на заявката")}},B=async(s,t)=>{try{if(console.log("\uD83D\uDD04 Dashboard - Updating case status:",s,"to",t),"accepted"===t)await n.x.acceptCase(s,e.id,"".concat(e.firstName," ").concat(e.lastName)),alert("Заявката беше приета успешно!");else if("declined"===t){console.log("\uD83D\uDEAB Declining case:",s,"by provider:",e.id);let t=await n.x.declineCase(s,e.id,"Declined by provider");console.log("\uD83D\uDEAB Decline response:",t),alert("Заявката беше отказана успешно!")}else if("completed"===t){let e=b.find(e=>e.id===s);if(e){_({isOpen:!0,caseId:s,caseTitle:e.description||e.service_type});return}}console.log("\uD83D\uDD04 Dashboard - Refreshing cases after status change..."),setTimeout(()=>{I(),S()},500)}catch(s){var a,r,l,i;console.error("❌ Error updating case status:",s),console.error("❌ Error details:",(null===(a=s.response)||void 0===a?void 0:a.data)||s.message);let e=(null===(i=s.response)||void 0===i?void 0:null===(l=i.data)||void 0===l?void 0:null===(r=l.error)||void 0===r?void 0:r.message)||s.message||"Възникна грешка при обновяването на статуса";alert("Грешка: ".concat(e))}},A=e=>{y(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},O=e=>({electrician:"Електричество",plumber:"Водопровод",hvac:"Климатик",carpenter:"Дърводелство",painter:"Боядисване",locksmith:"Ключарство",cleaner:"Почистване",gardener:"Градинарство",handyman:"Многопрофилен",appliance_repair:"Ремонти",general:"Общи"})[e]||e;return t?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-white/30 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-slate-200",children:"Зареждане..."})]})}):s&&e?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900",children:[(0,a.jsx)(x.Header,{}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Управление на заявки"}),(0,a.jsx)("p",{className:"text-slate-300",children:"customer"===e.role?"Вашите заявки за услуги":"Заявки за вашите услуги"})]}),((null==e?void 0:e.role)==="tradesperson"||(null==e?void 0:e.role)==="service_provider")&&(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4 mb-8",children:[(0,a.jsx)("button",{onClick:()=>k({...C,viewMode:"available",status:"",page:1}),className:"px-6 py-4 rounded-xl font-semibold text-base transition-all duration-300 transform hover:scale-105 ".concat("available"===C.viewMode?"bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg shadow-indigo-500/50":"bg-white/10 text-slate-300 hover:bg-white/20 border border-white/20"),children:"\uD83D\uDCCB Налични заявки"}),(0,a.jsx)("button",{onClick:()=>k({...C,viewMode:"assigned",status:"",page:1}),className:"px-6 py-4 rounded-xl font-semibold text-base transition-all duration-300 transform hover:scale-105 ".concat("assigned"===C.viewMode?"bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg shadow-indigo-500/50":"bg-white/10 text-slate-300 hover:bg-white/20 border border-white/20"),children:"✅ Моите заявки"})]}),D&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,a.jsx)("button",{onClick:()=>k({...C,viewMode:"available",status:"",page:1}),className:"text-left",children:(0,a.jsx)(o.Zb,{variant:"elevated",hover:!0,padding:"lg",className:"group cursor-pointer h-full",children:(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"Налични заявки"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-white",children:D.available||0})]}),(0,a.jsx)("div",{className:"p-4 rounded-2xl transition-all duration-300 group-hover:scale-110 bg-gradient-to-br from-green-500/20 to-green-400/20 border border-green-400/30",children:(0,a.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCCB"})})]})})})}),(0,a.jsx)("button",{onClick:()=>k({...C,viewMode:"assigned",status:"accepted",page:1}),className:"text-left",children:(0,a.jsx)(o.Zb,{variant:"elevated",hover:!0,padding:"lg",className:"group cursor-pointer h-full",children:(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"Приети"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-white",children:D.accepted||0})]}),(0,a.jsx)("div",{className:"p-4 rounded-2xl transition-all duration-300 group-hover:scale-110 bg-gradient-to-br from-blue-500/20 to-blue-400/20 border border-blue-400/30",children:(0,a.jsx)("span",{className:"text-3xl",children:"✅"})})]})})})}),(0,a.jsx)("button",{onClick:()=>k({...C,viewMode:"declined",status:"",page:1}),className:"text-left",children:(0,a.jsx)(o.Zb,{variant:"elevated",hover:!0,padding:"lg",className:"group cursor-pointer h-full",children:(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"Отказани"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-white",children:D.declined||0})]}),(0,a.jsx)("div",{className:"p-4 rounded-2xl transition-all duration-300 group-hover:scale-110 bg-gradient-to-br from-red-500/20 to-red-400/20 border border-red-400/30",children:(0,a.jsx)("span",{className:"text-3xl",children:"\uD83D\uDEAB"})})]})})})}),(0,a.jsx)("button",{onClick:()=>k({...C,viewMode:"assigned",status:"completed",page:1}),className:"text-left",children:(0,a.jsx)(o.Zb,{variant:"elevated",hover:!0,padding:"lg",className:"group cursor-pointer h-full",children:(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"Завършени"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-white",children:D.completed||0})]}),(0,a.jsx)("div",{className:"p-4 rounded-2xl transition-all duration-300 group-hover:scale-110 bg-gradient-to-br from-purple-500/20 to-purple-400/20 border border-purple-400/30",children:(0,a.jsx)("span",{className:"text-3xl",children:"\uD83C\uDFC1"})})]})})})})]}),(0,a.jsxs)(o.Zb,{variant:"elevated",padding:"lg",className:"mb-8",children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDD0D"}),"Допълнителни филтри"]})}),(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[((null==e?void 0:e.role)==="tradesperson"||(null==e?void 0:e.role)==="service_provider")&&"assigned"===C.viewMode&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-3",children:"Статус"}),(0,a.jsxs)("select",{value:C.status,onChange:e=>k({...C,status:e.target.value,page:1}),className:"w-full px-4 py-3 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-transparent transition-all duration-200 bg-white/10 text-white hover:border-white/30 backdrop-blur-sm [&>option]:bg-slate-800 [&>option]:text-white",children:[(0,a.jsx)("option",{value:"",className:"bg-slate-800 text-white",children:"Всички статуси"}),(0,a.jsx)("option",{value:"pending",className:"bg-slate-800 text-white",children:"\uD83C\uDD95 Нови"}),(0,a.jsx)("option",{value:"accepted",className:"bg-slate-800 text-white",children:"✅ Приети"}),(0,a.jsx)("option",{value:"declined",className:"bg-slate-800 text-white",children:"❌ Отказани"}),(0,a.jsx)("option",{value:"completed",className:"bg-slate-800 text-white",children:"\uD83C\uDFC1 Завършени"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-3",children:"Категория"}),(0,a.jsxs)("select",{value:C.category,onChange:e=>k({...C,category:e.target.value,page:1}),className:"w-full px-4 py-3 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-transparent transition-all duration-200 bg-white/10 text-white hover:border-white/30 backdrop-blur-sm [&>option]:bg-slate-800 [&>option]:text-white",children:[(0,a.jsx)("option",{value:"",className:"bg-slate-800 text-white",children:"Всички категории"}),(0,a.jsx)("option",{value:"electrician",className:"bg-slate-800 text-white",children:"⚡ Електротехник"}),(0,a.jsx)("option",{value:"plumber",className:"bg-slate-800 text-white",children:"\uD83D\uDD27 Водопроводчик"}),(0,a.jsx)("option",{value:"hvac",className:"bg-slate-800 text-white",children:"❄️ Климатик"}),(0,a.jsx)("option",{value:"carpenter",className:"bg-slate-800 text-white",children:"\uD83E\uDE9A Дърводелец"}),(0,a.jsx)("option",{value:"painter",className:"bg-slate-800 text-white",children:"\uD83C\uDFA8 Бояджия"}),(0,a.jsx)("option",{value:"locksmith",className:"bg-slate-800 text-white",children:"\uD83D\uDD10 Ключар"}),(0,a.jsx)("option",{value:"cleaner",className:"bg-slate-800 text-white",children:"\uD83E\uDDF9 Почистване"}),(0,a.jsx)("option",{value:"gardener",className:"bg-slate-800 text-white",children:"\uD83C\uDF31 Градинар"}),(0,a.jsx)("option",{value:"handyman",className:"bg-slate-800 text-white",children:"\uD83D\uDD28 Майстор за всичко"}),(0,a.jsx)("option",{value:"appliance_repair",className:"bg-slate-800 text-white",children:"\uD83D\uDD27 Ремонт на уреди"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-3",children:"Град"}),(0,a.jsxs)("select",{value:C.city,onChange:e=>k({...C,city:e.target.value,neighborhood:"",page:1}),className:"w-full px-4 py-3 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-transparent transition-all duration-200 bg-white/10 text-white hover:border-white/30 backdrop-blur-sm [&>option]:bg-slate-800 [&>option]:text-white",children:[(0,a.jsx)("option",{value:"",className:"bg-slate-800 text-white",children:"Всички градове"}),(0,a.jsx)("option",{value:"София",className:"bg-slate-800 text-white",children:"\uD83C\uDFD9️ София"}),(0,a.jsx)("option",{value:"Пловдив",className:"bg-slate-800 text-white",children:"\uD83C\uDFD9️ Пловдив"}),(0,a.jsx)("option",{value:"Варна",className:"bg-slate-800 text-white",children:"\uD83C\uDFD9️ Варна"}),(0,a.jsx)("option",{value:"Бургас",className:"bg-slate-800 text-white",children:"\uD83C\uDFD9️ Бургас"})]})]}),"София"===C.city&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-3",children:"Квартал"}),(0,a.jsxs)("select",{value:C.neighborhood,onChange:e=>k({...C,neighborhood:e.target.value,page:1}),className:"w-full px-4 py-3 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-transparent transition-all duration-200 bg-white/10 text-white hover:border-white/30 backdrop-blur-sm [&>option]:bg-slate-800 [&>option]:text-white",children:[(0,a.jsx)("option",{value:"",className:"bg-slate-800 text-white",children:"Всички квартали"}),m.vp.map(e=>(0,a.jsx)("option",{value:e,className:"bg-slate-800 text-white",children:e},e))]})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)(d.z,{variant:"construction",size:"lg",className:"w-full",leftIcon:(0,a.jsx)("span",{children:"➕"}),onClick:()=>g.push("/create-case"),children:"Нова заявка"})})]})})]}),(0,a.jsxs)(o.Zb,{variant:"elevated",children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDCCB"}),"Заявки за услуги"]})}),(0,a.jsx)(o.aY,{children:f?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-white/20 border-t-white/60 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-300 font-medium",children:"Зареждане на заявки..."})]}):0===b.length?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCED"}),(0,a.jsx)("p",{className:"text-slate-300 text-lg mb-4",children:"Няма намерени заявки"}),(0,a.jsx)(d.z,{variant:"construction",onClick:()=>g.push("/create-case"),leftIcon:(0,a.jsx)("span",{children:"➕"}),children:"Създай първата си заявка"})]}):(0,a.jsx)("div",{className:"space-y-4",children:b.map(s=>(0,a.jsx)(o.Zb,{variant:"outline",hover:!0,padding:"lg",className:"group cursor-pointer",onClick:()=>A(s.id),children:(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 flex flex-col items-center gap-2",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-white/10 to-white/20 border border-white/20 rounded-xl flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xl",children:"electrician"===s.category?"⚡":"plumber"===s.category?"\uD83D\uDD27":"hvac"===s.category?"❄️":"carpenter"===s.category?"\uD83E\uDE9A":"painter"===s.category?"\uD83C\uDFA8":"locksmith"===s.category?"\uD83D\uDD10":"cleaner"===s.category?"\uD83E\uDDF9":"gardener"===s.category?"\uD83C\uDF31":"handyman"===s.category?"\uD83D\uDD28":"\uD83D\uDD27"})}),(0,a.jsx)("div",{className:"min-w-[96px] max-w-[120px] px-2 py-1 rounded-full bg-indigo-500/20 border border-indigo-400/40 text-indigo-300 text-xs font-semibold text-center leading-tight break-words",children:O(s.category)})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white group-hover:text-slate-200 transition-colors duration-200",children:N.has(s.id)?s.description:"".concat(s.description.substring(0,80),"...")}),(0,a.jsx)("span",{className:"text-slate-500 transition-colors",children:N.has(s.id)?"▼":"▶"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-slate-300 mb-3",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCCD ",s.city,s.neighborhood?", ".concat(s.neighborhood):""]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCC5 ",new Date(s.created_at).toLocaleDateString("bg-BG")]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(c.OE,{status:s.status}),s.provider_id===(null==e?void 0:e.id)&&"specific"===s.assignment_type&&(0,a.jsx)(c.Ct,{variant:"construction",className:"animate-pulse",children:"⭐ Клиентът иска теб"}),s.provider_id&&s.provider_id!==(null==e?void 0:e.id)&&(0,a.jsxs)(c.Ct,{variant:"outline",children:["\uD83D\uDC64 Възложена на ",s.provider_name||"друг изпълнител"]})]}),N.has(s.id)&&(0,a.jsx)("div",{className:"mt-4 p-4 bg-white/5 rounded-lg border-l-4 border-blue-400/60 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-slate-200",children:"Телефон:"}),(0,a.jsx)("span",{className:"ml-2 text-slate-300",children:s.phone})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-slate-200",children:"Приоритет:"}),(0,a.jsx)("span",{className:"ml-2 text-slate-300",children:s.priority})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-slate-200",children:"Предпочитана дата:"}),(0,a.jsx)("span",{className:"ml-2 text-slate-300",children:s.preferred_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-slate-200",children:"Предпочитано време:"}),(0,a.jsx)("span",{className:"ml-2 text-slate-300",children:s.preferred_time})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("span",{className:"font-semibold text-slate-200",children:"Пълно описание:"}),(0,a.jsx)("p",{className:"mt-1 text-slate-300",children:s.description})]})]})})]})]})}),(0,a.jsx)("div",{className:"flex-shrink-0 ml-4",children:(null==e?void 0:e.role)==="tradesperson"||(null==e?void 0:e.role)==="service_provider"?(0,a.jsxs)("div",{className:"flex gap-2",children:["pending"===s.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.z,{variant:"construction",size:"sm",onClick:async t=>{if(t.stopPropagation(),"declined"===C.viewMode)try{await n.x.undeclineCase(s.id,e.id)}catch(e){console.error("Error undeclining:",e)}B(s.id,"accepted")},leftIcon:(0,a.jsx)("span",{children:"✅"}),children:"Приеми"}),"declined"!==C.viewMode&&(0,a.jsxs)("button",{onClick:e=>{e.stopPropagation(),B(s.id,"declined")},className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium rounded-lg bg-red-600 border-2 border-red-500 text-white hover:bg-red-700 hover:border-red-600 transition-all duration-200",children:[(0,a.jsx)("span",{className:"text-red-800 drop-shadow-lg",style:{textShadow:"0 0 4px rgba(255,255,255,1), 1px 1px 2px rgba(255,255,255,1), -1px -1px 2px rgba(255,255,255,1), 0px 1px 0px rgba(255,255,255,1), 0px -1px 0px rgba(255,255,255,1), 1px 0px 0px rgba(255,255,255,1), -1px 0px 0px rgba(255,255,255,1)"},children:"❌"}),"Откажи"]})]}),"accepted"===s.status&&(0,a.jsx)(d.z,{variant:"primary",size:"sm",onClick:e=>{e.stopPropagation(),B(s.id,"completed")},leftIcon:(0,a.jsx)("span",{children:"\uD83C\uDFC1"}),children:"Завърши"})]}):(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-slate-300 mb-1",children:"Изпълнител:"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:s.provider_name?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.q,{name:s.provider_name,size:"sm"}),(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:s.provider_name})]}):(0,a.jsx)(c.Ct,{variant:"outline",children:"Изчаква"})})]})})]})})},s.id))})})]})]}),(0,a.jsx)(h,{isOpen:E.isOpen,onClose:()=>_({isOpen:!1,caseId:"",caseTitle:""}),onComplete:M,caseTitle:E.caseTitle})]}):null}},3659:function(e,s,t){"use strict";t.d(s,{ZP:function(){return i},vp:function(){return l}});var a=t(7437),r=t(2265);let l=["7-и – 11-и километър","Абдовица","Аерогарата","Американски колеж (вилна зона)","БАН IV километър","Банишора","Барите","Батареята","Белите брези (квартал)","Бенковски (квартал)","Борово (квартал)","Ботунец","Ботунец 1","Ботунец 2","Бояна (квартал на София)","Бункера","Бъкстон","Васил Левски (квартал на София)","Витоша (квартал)","Воденицата","Военна рампа","Враждебна","Връбница-1","Връбница-2","Гевгелийски квартал","Гео Милев (квартал)","Горна баня","Горна баня (вилна зона)","Горубляне","Гоце Делчев (квартал)","Градина (квартал)","Група-Зоопарк","Гърдова глава","Дианабад","Дианабад (промишлена зона)","Димитър Миленков (квартал)","Долни Смърдан","Драгалевци","Дружба (квартал на София)","Друмо","Дървеница","Експериментален","Западен парк (квартал)","Захарна фабрика","Зона Б-18","Зона Б-19","Зона Б-5","Зона Б-5-3","Иван Вазов","Изгрев","Изток","Илинден","Илиянци","Искър","Канала","Карпузица","Килиите","Киноцентъра","Княжево","Красна поляна 1","Красна поляна 2","Красна поляна 3","Красно село","Кремиковци","Крива река","Кръстова вада","Лагера","Лев Толстой (жилищен комплекс)","Левски В","Левски Г","Лозенец (квартал на София)","Люлин (вилна зона)","Люлин (квартал)","Мала кория","Малинова долина","Малинова долина (жилищен комплекс)","Манастирски ливади","Манастирски ливади (жилищен комплекс)","Манастирски ливади - Б","Младост 1","Младост 1А","Младост 2","Младост 3","Младост 4","Могилата (вилна зона)","Модерно предградие","Модерно предградие (промишлена зона)","Надежда I","Надежда II","Надежда III","Надежда IV","Национален киноцентър","Нова махала – Враждебна","Нови силози","Обеля","Обеля 1","Обеля 2","Овча купел","Овча купел (жилищен комплекс)","Орландовци",'Парк „Бакърени гробища"',"Подлозище","Подуяне","Полигона (квартал)","Равнище (квартал)","Разсадник-Коньовица","Резиденция Бояна (квартал)","Република (квартал)","Република-2","Света Троица (квартал)","Свобода (квартал)","Секулица (квартал)","Сердика (жилищен комплекс)","Сеславци","Симеоново","Славия (квартал)","Слатина (промишлена зона)","Смърдана","Средец (промишлена зона)","Стрелбище (квартал)","Студентски град","Сухата река","Суходол (квартал)","Толева махала","Требич","Триъгълника-Надежда","Трънска махала","Факултета","Филиповци (жилищен комплекс)","Филиповци (квартал)","Фондови жилища","Фохар","Хаджи Димитър (жилищен комплекс)","Хаджи Димитър (промишлена зона)","Хиподрума","Хладилника","Хладилника (промишлена зона)","Христо Ботев (квартал на София)","Христо Смирненски (жилищен комплекс)","Център на София","Челопечене","Чепинско шосе","Черния кос","Черно конче","Южен парк (квартал)","Яворов (жилищен комплекс)","Япаджа"];function i(e){let{value:s,onChange:t,placeholder:i="Изберете квартал",required:n=!1,className:o="",disabled:d=!1}=e,[c,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)("");return l.filter(e=>e.toLowerCase().includes(x.toLowerCase())),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("select",{value:s,onChange:e=>t(e.target.value),required:n,disabled:d,className:o||"mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[(0,a.jsx)("option",{value:"",children:i}),l.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})})}},757:function(e,s,t){"use strict";t.d(s,{Ol:function(){return n},Zb:function(){return i},aY:function(){return d},ll:function(){return o}});var a=t(7437),r=t(2265),l=t(3448);let i=r.forwardRef((e,s)=>{let{className:t,variant:r="default",padding:i="md",hover:n=!1,children:o,...d}=e;return(0,a.jsx)("div",{className:(0,l.cn)("\n      rounded-xl transition-all duration-300 ease-in-out\n      ".concat(n?"hover:scale-[1.02] hover:shadow-xl cursor-pointer":"","\n    "),{default:"\n        bg-white/10 backdrop-blur-md border border-white/20 shadow-lg\n        hover:shadow-xl hover:bg-white/15\n      ",elevated:"\n        bg-white/10 backdrop-blur-md shadow-xl hover:shadow-2xl\n        border border-white/20 hover:border-white/30\n      ",glass:"\n        bg-white/10 backdrop-blur-md border border-white/20\n        shadow-lg hover:shadow-xl hover:bg-white/20\n      ",gradient:"\n        bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-md\n        border border-white/20 shadow-lg\n        hover:from-white/15 hover:to-white/10 hover:shadow-xl\n      ",outline:"\n        bg-transparent border-2 border-white/30\n        hover:border-white/50 hover:bg-white/10\n      "}[r],{none:"",sm:"p-4",md:"p-6",lg:"p-8",xl:"p-10"}[i],t),ref:s,...d,children:o})});i.displayName="Card";let n=r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 pb-4",t),...i,children:r})});n.displayName="CardHeader";let o=r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsx)("h3",{ref:s,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight text-white",t),...i,children:r})});o.displayName="CardTitle",r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsx)("p",{ref:s,className:(0,l.cn)("text-sm text-slate-300",t),...i,children:r})}).displayName="CardDescription";let d=r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("",t),...i,children:r})});d.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center pt-4",t),...i,children:r})}).displayName="CardFooter"}},function(e){e.O(0,[301,648,137,924,819,971,117,744],function(){return e(e.s=3338)}),_N_E=e.O()}]);