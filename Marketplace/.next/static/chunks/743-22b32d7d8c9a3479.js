"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[743],{9743:function(e,t,l){l.d(t,{Z:function(){return o}});var s=l(7437),i=l(2265),n=l(4362),a=l(1837);function o(e){let{isOpen:t,onClose:l,caseId:o,providerId:r,providerName:d,onSubmitSuccess:c}=e,{user:m}=(0,n.a)(),[u,x]=(0,i.useState)({rating:0,comment:"",communication:0,quality:0,timeliness:0,valueForMoney:0,wouldRecommend:void 0}),[h,b]=(0,i.useState)(!1),[v,f]=(0,i.useState)(null),p=(e,t,l,s)=>{let i=[e,t,l,s].filter(e=>e>0);return 0===i.length?0:Math.round(i.reduce((e,t)=>e+t,0)/i.length*2)/2},g=e=>{let{variant:t,size:l=24}=e,i=Math.random().toString(36).slice(2);return(0,s.jsxs)("svg",{width:l,height:l,viewBox:"0 0 24 24","aria-hidden":"true",className:"inline-block align-middle",children:["half"===t&&(0,s.jsx)("defs",{children:(0,s.jsxs)("linearGradient",{id:"half-".concat(i),x1:"0",x2:"1",y1:"0",y2:"0",children:[(0,s.jsx)("stop",{offset:"50%",stopColor:"#fbbf24"}),(0,s.jsx)("stop",{offset:"50%",stopColor:"#64748b"})]})}),(0,s.jsx)("path",{d:"M12 .587l3.668 7.429 8.2 1.192-5.934 5.786 1.402 8.173L12 18.896l-7.336 3.871 1.402-8.173L.132 9.208l8.2-1.192L12 .587z",fill:"full"===t?"#fbbf24":"half"===t?"url(#half-".concat(i,")"):"#64748b"})]})},j=(e,t)=>{x(l=>{let s={...l,[e]:t};if("rating"!==e){let i="communication"===e?t:l.communication||0,n=p(i,"quality"===e?t:l.quality||0,"timeliness"===e?t:l.timeliness||0,"valueForMoney"===e?t:l.valueForMoney||0);s.rating=n}return s})},y=(e,t)=>(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(l=>{let i=l<=t;return(0,s.jsx)("button",{type:"button",onClick:t=>{t.preventDefault(),j(e,l)},className:"transition-transform duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-50 rounded",title:"Оценка ".concat(l," от 5"),children:(0,s.jsx)(g,{variant:i?"full":"empty"})},l)}),t>0&&(0,s.jsxs)("span",{className:"ml-2 text-sm text-slate-400",children:[t,"/5"]})]}),w=async e=>{if(e.preventDefault(),0===u.rating){f("Моля поставете поне една оценка от категориите по-долу");return}if((null==m?void 0:m.id)===r){f("❌ Грешка: Не можете да оставите оценка за себе си като специалист.");return}b(!0),f(null);try{let e={caseId:o,providerId:r,rating:u.rating,comment:u.comment,communication:u.communication||void 0,serviceQuality:u.quality||void 0,timeliness:u.timeliness||void 0,valueForMoney:u.valueForMoney||void 0,wouldRecommend:u.wouldRecommend};await a.x.createReview(e),null==c||c(),l()}catch(l){var t,s,i,n,d,x;console.error("Error submitting survey:",l);let e=(null===(i=l.response)||void 0===i?void 0:null===(s=i.data)||void 0===s?void 0:null===(t=s.error)||void 0===t?void 0:t.message)||(null===(d=l.response)||void 0===d?void 0:null===(n=d.data)||void 0===n?void 0:n.message)||l.message;(null===(x=l.response)||void 0===x?void 0:x.status)===409||(null==e?void 0:e.includes("already exists"))?f("Вие вече сте оценили тази услуга. Не можете да изпратите повторна оценка."):f(e||"Възникна грешка при изпращането на оценката")}finally{b(!1)}};return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,s.jsx)("div",{className:"bg-slate-800/95 backdrop-blur-md border border-white/10 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Оценете услугата"}),(0,s.jsxs)("p",{className:"text-slate-300 mt-1",children:["Как оценявате работата на ",d,"?"]})]}),(0,s.jsx)("button",{onClick:l,className:"text-slate-400 hover:text-white text-2xl transition-colors",children:"✕"})]}),v&&(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-400/30 rounded-lg p-4 mb-6",children:(0,s.jsx)("p",{className:"text-red-300",children:v})}),(0,s.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-lg font-semibold text-white mb-3",children:["Обща оценка ",(0,s.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,s.jsx)("div",{className:"flex space-x-1",children:(e=>{let t=[],l=Math.floor(e),i=1e-9>Math.abs(e-l-.5);for(let e=1;e<=5;e++)e<=l?t.push((0,s.jsx)(g,{variant:"full"},e)):e===l+1&&i?t.push((0,s.jsx)(g,{variant:"half"},e)):t.push((0,s.jsx)(g,{variant:"empty"},e));return t})(u.rating)}),(0,s.jsx)("span",{className:"ml-2 text-lg font-medium text-slate-200",children:u.rating>0?"".concat(u.rating,"/5"):"Не е оценено"})]}),(0,s.jsx)("p",{className:"text-sm text-indigo-400 mt-2",children:"Общата оценка се изчислява автоматично като средна стойност (с половин звезди)"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Комуникация"}),y("communication",u.communication||0)]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Качество на работата"}),y("quality",u.quality||0)]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Спазване на срокове"}),y("timeliness",u.timeliness||0)]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Съотношение цена/качество"}),y("valueForMoney",u.valueForMoney||0)]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-3",children:"Бихте ли препоръчали този специалист?"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>x(e=>({...e,wouldRecommend:!0})),className:"px-4 py-2 rounded-lg border transition-colors ".concat(!0===u.wouldRecommend?"bg-green-500/20 border-green-400/50 text-green-300":"border-white/20 text-slate-300 hover:bg-white/10"),children:"\uD83D\uDC4D Да"}),(0,s.jsx)("button",{type:"button",onClick:()=>x(e=>({...e,wouldRecommend:!1})),className:"px-4 py-2 rounded-lg border transition-colors ".concat(!1===u.wouldRecommend?"bg-red-500/20 border-red-400/50 text-red-300":"border-white/20 text-slate-300 hover:bg-white/10"),children:"\uD83D\uDC4E Не"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Коментар (по желание)"}),(0,s.jsx)("textarea",{value:u.comment,onChange:e=>x(t=>({...t,comment:e.target.value})),rows:4,className:"w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all",placeholder:"Споделете вашето мнение за услугата..."})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-white/10",children:[(0,s.jsx)("button",{type:"button",onClick:l,disabled:h,className:"px-6 py-2 text-slate-300 bg-slate-700 rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:"Отказ"}),(0,s.jsx)("button",{type:"submit",disabled:h||0===u.rating,className:"px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-indigo-500/30",children:h?"Изпращане...":"Изпрати оценка"})]})]})]})})}):null}}}]);