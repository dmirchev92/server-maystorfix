exports.id=673,exports.ids=[673],exports.modules={8359:()=>{},3739:()=>{},2857:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},9290:(e,t,s)=>{Promise.resolve().then(s.bind(s,1631)),Promise.resolve().then(s.bind(s,6239)),Promise.resolve().then(s.bind(s,3355))},1631:(e,t,s)=>{"use strict";s.d(t,{Providers:()=>G});var r=s(326),a=s(5842),n=s(9718),o=s(8069);let i=(0,n.hg)("auth/login",async({email:e,password:t})=>await o.x.login(e,t)),l=(0,n.hg)("auth/register",async e=>(await o.x.register(e)).data),c=(0,n.hg)("auth/loadUser",async()=>(await o.x.getProfile()).data),d=(0,n.hg)("auth/logout",async()=>{await o.x.logout()}),u=(0,n.oM)({name:"auth",initialState:{user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null},reducers:{clearError:e=>{e.error=null},setToken:(e,t)=>{e.token=t.payload,e.isAuthenticated=!0}},extraReducers:e=>{e.addCase(i.pending,e=>{e.isLoading=!0,e.error=null}).addCase(i.fulfilled,(e,t)=>{e.isLoading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(i.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Login failed"}).addCase(l.pending,e=>{e.isLoading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.isLoading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(l.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Registration failed"}).addCase(c.fulfilled,(e,t)=>{e.user=t.payload,e.isAuthenticated=!0}).addCase(d.fulfilled,e=>{e.user=null,e.token=null,e.isAuthenticated=!1,e.error=null})}}),{clearError:g,setToken:h}=u.actions,m=u.reducer,p={providers:[],filters:{serviceType:"",city:"",neighborhood:"",minRating:0,maxPrice:void 0,availability:"any"},isLoading:!1,error:null,totalResults:0,currentPage:1},x=(0,n.hg)("search/providers",async e=>(await o.x.searchProviders(e)).data);(0,n.hg)("search/providerDetails",async e=>(await o.x.getProvider(e)).data);let v=(0,n.oM)({name:"search",initialState:p,reducers:{setFilters:(e,t)=>{e.filters={...e.filters,...t.payload}},clearFilters:e=>{e.filters=p.filters},setPage:(e,t)=>{e.currentPage=t.payload},clearError:e=>{e.error=null}},extraReducers:e=>{e.addCase(x.pending,e=>{e.isLoading=!0,e.error=null}).addCase(x.fulfilled,(e,t)=>{e.isLoading=!1,e.providers=t.payload.providers,e.totalResults=t.payload.totalResults,e.error=null}).addCase(x.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Search failed"})}}),{setFilters:f,clearFilters:C,setPage:y,clearError:D}=v.actions,w=v.reducer,k=(0,n.hg)("messaging/loadConversations",async()=>(await o.x.getConversations()).data),b=(0,n.hg)("messaging/sendMessage",async e=>(await o.x.sendMessage(e)).data),j=(0,n.oM)({name:"messaging",initialState:{conversations:[],activeConversation:null,isLoading:!1,error:null,unreadCount:0},reducers:{setActiveConversation:(e,t)=>{e.activeConversation=t.payload},addMessage:(e,t)=>{let{conversationId:s,message:r}=t.payload,a=e.conversations.find(e=>e.id===s);a&&(a.messages.push(r),a.lastActivity=r.timestamp,r.senderId!==e.activeConversation?.id&&(e.unreadCount+=1))},markAsRead:(e,t)=>{let s=t.payload,r=e.conversations.find(e=>e.id===s);r&&(r.messages.forEach(e=>{e.isRead=!0}),e.unreadCount=Math.max(0,e.unreadCount-1))},clearError:e=>{e.error=null}},extraReducers:e=>{e.addCase(k.pending,e=>{e.isLoading=!0,e.error=null}).addCase(k.fulfilled,(e,t)=>{e.isLoading=!1,e.conversations=t.payload,e.unreadCount=t.payload.reduce((e,t)=>e+t.messages.filter(e=>!e.isRead).length,0),e.error=null}).addCase(k.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to load conversations"}).addCase(b.fulfilled,(e,t)=>{e.error=null}).addCase(b.rejected,(e,t)=>{e.error=t.error.message||"Failed to send message"})}}),{setActiveConversation:A,addMessage:P,markAsRead:N,clearError:I}=j.actions,S=j.reducer,$=(0,n.xC)({reducer:{auth:m,search:w,messaging:S},middleware:e=>e({serializableCheck:{ignoredActions:["persist/PERSIST"]}})});var M=s(9211),R=s(4001),L=s(7577);let T=(0,L.createContext)({openWithProvider:()=>{},isOpen:!1,setIsOpen:()=>{},activeProviderId:null,activeProviderName:null});function B({children:e}){let[t,s]=(0,L.useState)(!1),[a,n]=(0,L.useState)(null),[o,i]=(0,L.useState)(null);return r.jsx(T.Provider,{value:{openWithProvider:(e,t)=>{n(e),i(t),s(!0)},isOpen:t,setIsOpen:s,activeProviderId:a,activeProviderName:o},children:e})}var U=s(7293);function G({children:e}){return r.jsx(a.zt,{store:$,children:r.jsx(R.H,{children:r.jsx(M.w,{children:r.jsx(U.a,{children:r.jsx(B,{children:e})})})})})}},6239:(e,t,s)=>{"use strict";s.d(t,{default:()=>d});var r=s(326),a=s(7577),n=s(5047),o=s(4001),i=s(7293),l=s(5666);function c(){let{user:e,isAuthenticated:t}=(0,o.a)(),{conversations:s,activeConversationId:c,messages:d,loading:u,connected:g,setActiveConversation:h,loadConversations:m,loadMessages:p,sendMessage:x,markAsRead:v}=(0,i.R)(),[f,C]=(0,a.useState)(!1),[y,D]=(0,a.useState)(!1),[w,k]=(0,a.useState)(""),b=(0,n.usePathname)(),j=s.reduce((e,t)=>e+(t.unreadCount||0),0),A=s.find(e=>e.id===c),P=c&&d[c]||[],N=async()=>{w.trim()&&c&&(await x(c,w.trim()),k(""))},I=e=>{h(e)},S=e=>{let t=new Date(e),s=new Date().getTime()-t.getTime(),r=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return r<1?"Сега":r<60?`${r} мин`:a<24?`${a} ч`:n<7?`${n} д`:t.toLocaleDateString("bg-BG",{day:"numeric",month:"short"})};return b?.startsWith("/auth/")?null:t&&e?(0,r.jsxs)(r.Fragment,{children:[!f&&(0,r.jsxs)("button",{onClick:()=>C(!0),className:"fixed bottom-6 right-6 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white p-4 rounded-full shadow-lg transition-all duration-200 z-[9999] border-4 border-white","aria-label":"Отвори чат",children:[r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),j>0&&r.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold",children:j>99?"99+":j}),g&&r.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),f&&(0,r.jsxs)("div",{className:`fixed bottom-6 right-6 bg-white rounded-lg shadow-2xl border border-gray-200 z-[9999] transition-all duration-200 flex flex-col ${y?"w-80 h-14":"w-96 h-[600px]"}`,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-t-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[A&&!y&&r.jsx("button",{onClick:()=>{h(null)},className:"hover:bg-white/10 p-1 rounded transition",title:"Назад",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),r.jsx("div",{className:`w-2 h-2 rounded-full ${g?"bg-green-400":"bg-gray-400"}`}),r.jsx("div",{className:"flex-1 min-w-0",children:A?(0,r.jsxs)(r.Fragment,{children:[r.jsx("span",{className:"font-medium text-sm truncate block",children:e?.role==="customer"?A.providerBusinessName||A.providerName||"Майстор":A.customerName||"Клиент"}),e?.role==="customer"&&A.providerServiceCategory&&r.jsx("span",{className:"text-xs text-indigo-200 truncate block",children:A.providerServiceCategory})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("span",{className:"font-medium text-sm truncate block",children:"Съобщения"}),j>0&&(0,r.jsxs)("span",{className:"text-xs text-indigo-200",children:[j," непрочетени"]})]})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>D(!y),className:"hover:bg-white/10 p-1 rounded transition",title:y?"Разшири":"Минимизирай",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y?r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"}):r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),r.jsx("button",{onClick:()=>C(!1),className:"hover:bg-white/10 p-1 rounded transition",title:"Затвори",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),!y&&r.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:A?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"chat-messages-container flex-1 overflow-y-auto bg-gray-50 p-3 space-y-2",children:u&&0===P.length?r.jsx("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-2"}),r.jsx("p",{className:"text-sm",children:"Зареждане..."})]})}):0===P.length?r.jsx("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[r.jsx("div",{className:"text-3xl mb-2",children:"\uD83D\uDCAC"}),r.jsx("p",{className:"text-sm",children:"Няма съобщения"}),r.jsx("p",{className:"text-xs mt-1",children:"Започнете разговор"})]})}):P.map((e,t)=>{let s=0===t||P[t-1].senderUserId!==e.senderUserId;return r.jsx(l.Z,{message:e,showSenderName:s},e.id)})}),r.jsx("div",{className:"border-t p-3 bg-white",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",value:w,onChange:e=>k(e.target.value),onKeyPress:e=>"Enter"===e.key&&N(),placeholder:"Напишете съобщение...",className:"flex-1 border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500",disabled:u}),r.jsx("button",{onClick:N,disabled:!w.trim()||u,className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-lg disabled:opacity-50 hover:from-purple-700 hover:to-indigo-700 transition",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]}):r.jsx("div",{className:"flex-1 overflow-y-auto",children:u?r.jsx("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-2"}),r.jsx("p",{className:"text-sm",children:"Зареждане..."})]})}):0===s.length?r.jsx("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center text-gray-500 p-4",children:[r.jsx("div",{className:"text-4xl mb-2",children:"\uD83D\uDCAC"}),r.jsx("p",{className:"text-sm font-medium",children:"Няма разговори"}),r.jsx("p",{className:"text-xs mt-1",children:"Започнете нов разговор"})]})}):s.map(t=>{let s=(t.unreadCount||0)>0,a=e?.role==="customer"?t.providerBusinessName||t.providerName||"Майстор":t.customerName||"Клиент",n=a.charAt(0).toUpperCase(),o=e?.role==="customer"&&t.providerServiceCategory;return(0,r.jsxs)("button",{onClick:()=>I(t.id),className:`group w-full p-3.5 rounded-lg border border-transparent text-left relative transition-all
                            hover:bg-white hover:shadow-sm hover:border-purple-200
                            ${s?"bg-purple-50/40":""}
                          `,children:[r.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 rounded-l-lg transition-colors ${s?"bg-purple-500":"bg-transparent"} group-hover:bg-purple-400`}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"relative flex-shrink-0",children:r.jsx("div",{className:"w-11 h-11 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-sm",children:r.jsx("span",{className:"text-white font-semibold text-sm",children:n})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[r.jsx("h3",{className:`font-semibold text-sm truncate ${s?"text-gray-900":"text-gray-800"}`,children:a}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[r.jsx("span",{className:"text-[11px] text-gray-400",children:S(t.lastMessageAt)}),s&&r.jsx("span",{className:"inline-flex items-center justify-center min-w-5 h-5 px-1.5 rounded-full bg-purple-600 text-white text-[10px] font-bold",children:t.unreadCount})]})]}),(0,r.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[o&&(0,r.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full border border-purple-300 text-purple-700 bg-white text-[11px] font-medium flex-shrink-0 group-hover:border-purple-400 group-hover:bg-purple-50",children:[r.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})}),t.providerServiceCategory]}),r.jsx("p",{className:`truncate text-xs ${s?"text-gray-700":"text-gray-500"}`,children:t.lastMessage?.body||"Няма съобщения"})]})]})]})]},t.id)})})})]})]}):(0,r.jsxs)("button",{onClick:()=>window.location.href="/auth/login",className:"fixed bottom-6 right-6 bg-gray-600 hover:bg-gray-700 text-white p-4 rounded-full shadow-lg transition-all duration-200 z-[9999]","aria-label":"Влезте за чат",children:[r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),r.jsx("div",{className:"absolute -top-2 -right-2 bg-blue-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold",children:"!"})]})}function d(){let e=(0,n.usePathname)();return e?.startsWith("/auth/")||"/chat"===e?null:r.jsx(c,{})}},3355:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var r=s(326),a=s(7577),n=s(434);function o(){let[e,t]=(0,a.useState)(!1);return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end justify-center p-4 gdpr-popup-overlay",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6 gdpr-popup-content",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Защита на личните данни"}),(0,r.jsxs)("p",{className:"text-gray-600 text-sm mb-4",children:["Използваме бисквитки и други технологии за подобряване на вашето изживяване. Като продължите да използвате нашия сайт, вие се съгласявате с нашата"," ",r.jsx(n.default,{href:"/privacy-policy",className:"text-blue-600 hover:underline",children:"политика за поверителност"}),"."]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[r.jsx("button",{onClick:()=>{localStorage.setItem("gdpr_consent_shown","true"),localStorage.setItem("gdpr_consent_accepted","true"),localStorage.setItem("gdpr_consent_date",new Date().toISOString()),t(!1)},className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:"Приемам"}),r.jsx("button",{onClick:()=>{localStorage.setItem("gdpr_consent_shown","true"),localStorage.setItem("gdpr_consent_accepted","false"),localStorage.setItem("gdpr_consent_date",new Date().toISOString()),t(!1)},className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-300 transition-colors",children:"Отказвам"})]})]})}):null}},5666:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var r=s(326);s(7577);var a=s(4001);function n({message:e,showSenderName:t=!0}){let{user:s}=(0,a.a)(),n=e.senderUserId===s?.id;return r.jsx("div",{className:`flex ${n?"justify-end":"justify-start"} mb-3`,children:(0,r.jsxs)("div",{className:`max-w-[70%] ${n?"items-end":"items-start"} flex flex-col`,children:[!n&&t&&r.jsx("span",{className:"text-xs text-gray-500 mb-1 px-2",children:e.senderName}),(0,r.jsxs)("div",{className:`
            px-4 py-2 rounded-lg break-words
            ${n?"bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-br-none":"bg-gray-200 text-gray-900 rounded-bl-none"}
            ${e.deletedAt?"opacity-50 italic":""}
          `,children:[e.deletedAt?r.jsx("span",{className:"text-sm",children:"Това съобщение е изтрито"}):r.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.body}),e.editedAt&&!e.deletedAt&&r.jsx("span",{className:`text-xs ${n?"text-purple-200":"text-gray-500"} ml-2`,children:"(редактирано)"})]}),(0,r.jsxs)("div",{className:`flex items-center gap-1 mt-1 px-2 ${n?"flex-row-reverse":"flex-row"}`,children:[r.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.sentAt).toLocaleTimeString("bg-BG",{hour:"2-digit",minute:"2-digit"})}),n&&r.jsx("span",{className:"text-xs",children:e.isRead?r.jsx("span",{className:"text-blue-500",title:"Прочетено",children:"✓✓"}):r.jsx("span",{className:"text-gray-400",title:"Изпратено",children:"✓"})})]}),e.attachments&&e.attachments.length>0&&r.jsx("div",{className:"mt-2 space-y-2",children:e.attachments.map(e=>r.jsx("div",{className:"rounded-lg overflow-hidden",children:e.mimeType.startsWith("image/")?r.jsx("img",{src:e.url,alt:"Attachment",className:"max-w-full h-auto rounded-lg cursor-pointer hover:opacity-90 transition",onClick:()=>window.open(e.url,"_blank")}):(0,r.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:`
                      flex items-center gap-2 px-3 py-2 rounded-lg
                      ${n?"bg-purple-700 text-white":"bg-gray-300 text-gray-900"}
                      hover:opacity-80 transition
                    `,children:[r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),r.jsx("span",{className:"text-sm truncate",children:"Файл"})]})},e.id))})]})})}},4001:(e,t,s)=>{"use strict";s.d(t,{H:()=>o,a:()=>i});var r=s(326),a=s(7577);let n=(0,a.createContext)(void 0);function o({children:e}){let[t,s]=(0,a.useState)(null),[o,i]=(0,a.useState)(!0),l=async(e,t)=>{try{console.log("\uD83D\uDD10 AuthContext - Starting login process...");let r=await fetch("https://maystorfix.com/api/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await r.json();if(console.log("\uD83D\uDD10 AuthContext - Login response:",a),a.success&&a.data?.tokens?.accessToken){console.log("✅ AuthContext - Login successful, updating state..."),localStorage.setItem("auth_token",a.data.tokens.accessToken),a.data.tokens.refreshToken&&localStorage.setItem("refresh_token",a.data.tokens.refreshToken);let e=a.data.user;if("tradesperson"===e.role||"service_provider"===e.role)try{console.log("\uD83D\uDDBC️ AuthContext - Fetching profile image after login for user:",e.id);let t=await fetch(`https://maystorfix.com/api/v1/marketplace/providers/${e.id}`,{headers:{Authorization:`Bearer ${a.data.tokens.accessToken}`}}),s=await t.json();console.log("\uD83D\uDDBC️ AuthContext - Profile data after login:",s),console.log("\uD83D\uDDBC️ AuthContext - Profile image URL:",s.data?.profileImageUrl),s.success&&s.data?.profileImageUrl?(e.profileImageUrl=s.data.profileImageUrl,console.log("✅ AuthContext - Set profile image URL after login:",e.profileImageUrl)):console.log("⚠️ AuthContext - No profile image URL in response after login")}catch(e){console.log("❌ AuthContext - Could not fetch profile image after login:",e)}return localStorage.setItem("user_data",JSON.stringify(e)),s(e),i(!1),console.log("✅ AuthContext - User state updated:",e),window.dispatchEvent(new CustomEvent("auth-state-changed",{detail:{user:e,isAuthenticated:!0}})),{success:!0}}{console.error("❌ AuthContext - Login failed:",a);let e=a.error?.message||"Login failed. Please check your credentials.",t=a.error?.details||null;return console.log("\uD83D\uDD0D AuthContext - Error details:",{message:e,debugInfo:t}),{success:!1,error:e,debugInfo:t}}}catch(e){return console.error("❌ AuthContext - Login error:",e),{success:!1,error:"Network error. Please check your connection and try again."}}},c=async e=>{try{let t=await fetch("https://maystorfix.com/api/v1/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(r.success&&r.data?.tokens?.accessToken)return localStorage.setItem("auth_token",r.data.tokens.accessToken),r.data.tokens.refreshToken&&localStorage.setItem("refresh_token",r.data.tokens.refreshToken),localStorage.setItem("user_data",JSON.stringify(r.data.user)),s(r.data.user),!0;return!1}catch(e){return console.error("Registration error:",e),!1}},d=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("refresh_token");if(!e)return!1;let t=await fetch("https://maystorfix.com/api/v1/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})}),s=await t.json();if(s.success&&s.data?.accessToken)return localStorage.setItem("auth_token",s.data.accessToken),s.data.refreshToken&&localStorage.setItem("refresh_token",s.data.refreshToken),!0;return!1}catch(e){return console.error("Token refresh error:",e),!1}},[]);return r.jsx(n.Provider,{value:{user:t,isAuthenticated:!!t,isLoading:o,login:l,logout:()=>{localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_data"),s(null)},register:c,refreshToken:d,updateUser:e=>{s(e),localStorage.setItem("user_data",JSON.stringify(e)),console.log("✅ AuthContext - User updated:",e)}},children:e})}function i(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7293:(e,t,s)=>{"use strict";s.d(t,{a:()=>d,R:()=>u});var r=s(326),a=s(7577),n=s(8069);class o{static async getConversations(e){return(await n.x.client.get("/chat/conversations",{params:e})).data.data}static async createConversation(e){return(await n.x.client.post("/chat/conversations",e)).data.data}static async getConversation(e){return(await n.x.client.get(`/chat/conversations/${e}`)).data.data}static async getMessages(e,t){return(await n.x.client.get(`/chat/conversations/${e}/messages`,{params:t})).data.data}static async sendMessage(e,t){return(await n.x.client.post(`/chat/conversations/${e}/messages`,t)).data.data}static async editMessage(e,t){return(await n.x.client.patch(`/chat/messages/${e}`,{body:t})).data.data}static async deleteMessage(e){await n.x.client.delete(`/chat/messages/${e}`)}static async markAsRead(e){await n.x.client.post(`/chat/conversations/${e}/read`)}static async updateReceipt(e,t){await n.x.client.post(`/chat/messages/${e}/receipts`,{status:t})}static async getReceipts(e){return(await n.x.client.get(`/chat/messages/${e}/receipts`)).data.data}}var i=s(4001),l=s(9211);let c=(0,a.createContext)(void 0);function d({children:e,initialConversationId:t}){let{user:s,isAuthenticated:n}=(0,i.a)(),{socket:d,isConnected:u}=(0,l.s)(),[g,h]=(0,a.useState)([]),[m,p]=(0,a.useState)(t||null),[x,v]=(0,a.useState)({}),[f,C]=(0,a.useState)(!1),[y,D]=(0,a.useState)(u),w=(0,a.useRef)(d),k=(0,a.useCallback)(async()=>{try{C(!0);let e=await o.getConversations();h(e.conversations)}catch(e){console.error("Error loading conversations:",e)}finally{C(!1)}},[]),b={conversations:g,activeConversationId:m,messages:x,loading:f,connected:y,setActiveConversation:p,loadConversations:k,loadMessages:(0,a.useCallback)(async e=>{try{C(!0);let t=await o.getMessages(e);v(s=>({...s,[e]:t.messages}))}catch(e){console.error("Error loading messages:",e)}finally{C(!1)}},[]),sendMessage:(0,a.useCallback)(async(e,t,s="text")=>{try{if(!w.current?.connected)throw Error("Socket not connected");console.log("\uD83D\uDCE4 Sending message via socket:",{conversationId:e,bodyPreview:t.substring(0,50),type:s,socketConnected:w.current.connected}),w.current.emit("message:send",{conversationId:e,type:s,body:t}),console.log("✅ Message sent via socket, waiting for confirmation...")}catch(e){throw console.error("Error sending message:",e),e}},[s]),markAsRead:(0,a.useCallback)(async e=>{try{await o.markAsRead(e),v(t=>({...t,[e]:(t[e]||[]).map(e=>({...e,isRead:!0}))})),h(t=>t.map(t=>t.id===e?{...t,unreadCount:0}:t))}catch(e){console.error("Error marking as read:",e)}},[]),socket:w.current};return r.jsx(c.Provider,{value:b,children:e})}function u(){let e=(0,a.useContext)(c);if(!e)throw Error("useChat must be used within ChatProvider");return e}},9211:(e,t,s)=>{"use strict";s.d(t,{s:()=>i,w:()=>l});var r=s(326),a=s(7577);s(57);var n=s(4001);let o=(0,a.createContext)({socket:null,isConnected:!1}),i=()=>(0,a.useContext)(o);function l({children:e}){let[t,s]=(0,a.useState)(null),[i,l]=(0,a.useState)(!1),{isAuthenticated:c}=(0,n.a)();return r.jsx(o.Provider,{value:{socket:t,isConnected:i},children:e})}},8069:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o,x:()=>n});var r=s(4464);class a{constructor(){this.client=r.Z.create({baseURL:"https://maystorfix.com/api/v1",headers:{"Content-Type":"application/json"},timeout:1e4}),this.setupInterceptors()}setupInterceptors(){this.client.interceptors.request.use(e=>{let t=this.getAuthToken();return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>(e.response?.status===401&&(this.clearAuthToken(),window.location.href="/auth/login"),Promise.reject(e)))}getAuthToken(){return null}clearAuthToken(){}async login(e,t){let{token:s,refreshToken:r,user:a}=(await this.client.post("/auth/login",{email:e,password:t})).data;return{user:a,token:s,refreshToken:r}}async register(e){return this.client.post("/auth/register",e)}async logout(){return this.clearAuthToken(),this.client.post("/auth/logout")}async searchProviders(e){console.log("\uD83D\uDD0D API Client - Making request with filters:",e);try{let t=await this.client.get("/marketplace/providers/search",{params:e});return console.log("✅ API Client - Response received:",t),t}catch(e){throw console.error("❌ API Client - Request failed:",e),e}}async getProvider(e){return this.client.get(`/marketplace/providers/${e}`)}async validatePublicChat(e,t){return this.client.get(`/chat/public/${e}/validate/${t}`)}async createBooking(e){return this.client.post("/marketplace/bookings",e)}async getBookings(){return this.client.get("/marketplace/bookings")}async getConversations(){let e=JSON.parse(localStorage.getItem("user_data")||localStorage.getItem("user")||"{}");return"customer"===e.role?this.client.get(`/chat/user/${e.id}/conversations`):this.client.get(`/chat/provider/${e.id}/conversations`)}async getProfile(){return this.client.get("/auth/profile")}async updateProfile(e){return this.client.put("/auth/profile",e)}async getConsentStatus(){return this.client.get("/gdpr/consent-summary")}async updateConsent(e){return this.client.post("/gdpr/consent",e)}async startMarketplaceConversation(e){console.log("\uD83D\uDD17 API Client - Starting marketplace conversation:",e);let t={providerId:e.providerId,customerId:e.customerId,customerName:e.customerName,customerEmail:e.customerEmail,customerPhone:e.customerPhone||""};console.log("\uD83D\uDD17 API Client - Request payload:",JSON.stringify(t,null,2));try{let e=await this.client.post("/chat/conversations",t);return console.log("\uD83D\uDD17 API Client - Response:",e.data),e}catch(e){throw console.error("\uD83D\uDD17 API Client - Error:",e.response?.data||e.message),e}}async createOrGetConversation(e){return this.startMarketplaceConversation(e)}async startConversation(e){return this.startMarketplaceConversation(e)}async sendMarketplaceMessage(e){return console.log("\uD83D\uDCAC API Client - Sending marketplace message:",e.message.substring(0,50)+"..."),console.log("\uD83D\uDCAC API Client - Base URL:",this.client.defaults.baseURL),console.log("\uD83D\uDCAC API Client - Full URL would be:",this.client.defaults.baseURL+"/chat/messages"),this.client.post("/chat/messages",e)}async sendMessage(e){return this.sendMarketplaceMessage(e)}async getMarketplaceMessages(e,t){console.log("\uD83D\uDCD6 API Client - Getting marketplace messages for:",e),console.log("\uD83D\uDCD6 API Client - Base URL:",this.client.defaults.baseURL);let s=`/chat/conversations/${e}/messages`;return console.log("\uD83D\uDCD6 API Client - Request URL:",s),console.log("\uD83D\uDCD6 API Client - Full URL would be:",this.client.defaults.baseURL+s),this.client.get(s,{params:t?{limit:t}:{}})}async getConversationMessages(e,t){return this.getMarketplaceMessages(e,t)}async getMarketplaceConversation(e){return this.client.get(`/chat/conversations/${e}`)}async getConversationsV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Getting conversations"),this.client.get("/chat/conversations",{params:e})}async createConversationV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Creating conversation:",e),this.client.post("/chat/conversations",e)}async getConversationV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Getting conversation:",e),this.client.get(`/chat/conversations/${e}`)}async getMessagesV2(e,t){return console.log("\uD83D\uDCAC Chat API V2 - Getting messages for:",e),this.client.get(`/chat/conversations/${e}/messages`,{params:t})}async sendMessageV2(e,t){return console.log("\uD83D\uDCAC Chat API V2 - Sending message to:",e),this.client.post(`/chat/conversations/${e}/messages`,t)}async markConversationReadV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Marking conversation as read:",e),this.client.post(`/chat/conversations/${e}/read`)}async editMessageV2(e,t){return console.log("\uD83D\uDCAC Chat API V2 - Editing message:",e),this.client.patch(`/chat/messages/${e}`,{body:t})}async deleteMessageV2(e){return console.log("\uD83D\uDCAC Chat API V2 - Deleting message:",e),this.client.delete(`/chat/messages/${e}`)}async updateReceiptV2(e,t){return console.log("\uD83D\uDCAC Chat API V2 - Updating receipt for:",e,"to",t),this.client.post(`/chat/messages/${e}/receipts`,{status:t})}async createCase(e){return console.log("\uD83D\uDCCB API Client - Creating case:",e),this.client.post("/cases",e)}async getCases(e){return console.log("\uD83D\uDCCB API Client - Getting cases with filters:",e),this.client.get("/cases",{params:e})}async getCase(e){return console.log("\uD83D\uDCCB API Client - Getting case:",e),this.client.get(`/cases/${e}`)}async assignCase(e,t,s){return(console.log("\uD83D\uDCCB API Client - Assigning case:",e,t),"accept"===t)?this.client.post(`/cases/${e}/accept`):this.client.post(`/cases/${e}/decline`,{reason:s})}async declineCase(e,t,s){return console.log("\uD83D\uDCCB API Client - Declining case:",e,"by provider:",t),this.client.post(`/cases/${e}/decline`,{providerId:t,reason:s})}async getDeclinedCases(e){return console.log("\uD83D\uDEAB API Client - Getting declined cases for provider:",e),this.client.get(`/cases/declined/${e}`)}async undeclineCase(e,t){return console.log("✅ API Client - Un-declining case:",e,"for provider:",t),this.client.post(`/cases/${e}/undecline`,{providerId:t})}async updateCaseStatus(e,t,s){return(console.log("\uD83D\uDCCB API Client - Updating case status:",e,t),"completed"===t||"closed"===t)?this.client.post(`/cases/${e}/complete`,{completionNotes:s}):this.client.put(`/cases/${e}/status`,{status:t,message:s})}async updateCaseStatusDirect(e,t,s){return console.log("\uD83D\uDCCB API Client - Direct status update:",e,t),this.client.put(`/cases/${e}/status`,{status:t,message:s})}async getProviderCases(e,t){return console.log("\uD83D\uDCCB API Client - Getting provider cases:",e,t),this.client.get(`/cases/provider/${e}`,{params:t?{status:t}:{}})}async getAvailableCases(e,t){return console.log("\uD83D\uDCCB API Client - Getting available cases:",e,t),this.client.get(`/cases/queue/${e}`,{params:t})}async getProviderMarketplaceConversations(e){return this.client.get(`/chat/provider/${e}/conversations`)}async markMarketplaceAsRead(e,t){return this.client.put(`/chat/conversations/${e}/read`,{senderType:t})}async getCaseTemplate(e){return this.client.get(`/cases/templates/${e}`)}async createServiceCase(e){return this.client.post("/cases",e)}async updateServiceCase(e,t){return this.client.put(`/cases/${e}`,t)}async getServiceCaseByConversation(e){return this.client.get(`/cases/conversation/${e}`)}async getReferralDashboard(){return console.log("\uD83D\uDCCA API Client - Getting referral dashboard"),this.client.get("/referrals/dashboard")}async generateReferralCode(){return console.log("\uD83D\uDD17 API Client - Generating referral code"),this.client.post("/referrals/generate")}async trackReferralClick(e,t){return console.log("\uD83D\uDC46 API Client - Tracking referral click:",e),this.client.post(`/referrals/track/${e}`,t)}async getReferralStats(e){return console.log("\uD83D\uDCC8 API Client - Getting referral stats:",e),this.client.get(`/referrals/stats/${e}`)}async getReferredUsers(){return console.log("\uD83D\uDC65 API Client - Getting referred users"),this.client.get("/referrals/users")}async getReferralRewards(){return console.log("\uD83C\uDF81 API Client - Getting referral rewards"),this.client.get("/referrals/rewards")}async claimReferralReward(e){return console.log("\uD83C\uDFAF API Client - Claiming referral reward:",e),this.client.post(`/referrals/rewards/${e}/claim`)}async getReferralLink(){return console.log("\uD83D\uDD17 API Client - Getting referral link"),this.client.get("/referrals/link")}async getCasesWithFilters(e){console.log("\uD83D\uDCCB API Client - Getting cases with filters:",e);let t=new URLSearchParams;return Object.entries(e).forEach(([e,s])=>{null!=s&&t.append(e,s.toString())}),this.client.get(`/cases?${t.toString()}`)}async getCaseStats(e,t){console.log("\uD83D\uDCCA API Client - Getting case stats");let s=new URLSearchParams;return e&&s.append("providerId",e),t&&s.append("customerId",t),this.client.get(`/cases/stats?${s.toString()}`)}async acceptCase(e,t,s){return console.log("✅ API Client - Accepting case:",e),this.client.post(`/cases/${e}/accept`,{providerId:t,providerName:s})}async completeCase(e,t,s){return console.log("\uD83C\uDFC1 API Client - Completing case:",e,"with income:",s),this.client.post(`/cases/${e}/complete`,{completionNotes:t,income:s})}async getIncomeStats(e,t,s){console.log("\uD83D\uDCB0 API Client - Getting income stats for provider:",e);let r=new URLSearchParams;t&&r.append("startDate",t),s&&r.append("endDate",s);let a=r.toString()?`?${r.toString()}`:"";return this.client.get(`/income/provider/${e}${a}`)}async getIncomeYears(e){return console.log("\uD83D\uDCC5 API Client - Getting income years for provider:",e),this.client.get(`/income/provider/${e}/years`)}async getIncomeTransactionsByMethod(e,t){return console.log("\uD83D\uDCB0 API Client - Getting transactions for method:",t),this.client.get(`/income/provider/${e}/method/${encodeURIComponent(t)}`)}async getIncomeTransactionsByMonth(e,t){return console.log("\uD83D\uDCB0 API Client - Getting transactions for month:",t),this.client.get(`/income/provider/${e}/month/${t}`)}async updateIncomeTransaction(e,t){return console.log("\uD83D\uDCB0 API Client - Updating income transaction:",e),this.client.put(`/income/${e}`,t)}async getSmartMatches(e,t){console.log("\uD83C\uDFAF API Client - Getting smart matches for case:",e);let s=t?`?limit=${t}`:"";return this.client.get(`/cases/${e}/smart-matches${s}`)}async getUserNotifications(){return console.log("\uD83D\uDD14 API Client - Getting user notifications"),this.client.get("/notifications")}async getUnreadNotificationCount(){return console.log("\uD83D\uDD14 API Client - Getting unread notification count"),this.client.get("/notifications/unread-count")}async markNotificationAsRead(e){return console.log("\uD83D\uDD14 API Client - Marking notification as read:",e),this.client.post(`/notifications/${e}/read`)}async markAllNotificationsAsRead(){return console.log("\uD83D\uDD14 API Client - Marking all notifications as read"),this.client.post("/notifications/mark-all-read")}async createReview(e){return console.log("⭐ API Client - Creating review:",e.caseId),this.client.post("/reviews",e)}async getProviderReviews(e,t,s){console.log("⭐ API Client - Getting provider reviews:",e);let r=new URLSearchParams;return t&&r.append("page",t.toString()),s&&r.append("limit",s.toString()),this.client.get(`/reviews/provider/${e}?${r.toString()}`)}async getProviderReviewStats(e){return console.log("\uD83D\uDCCA API Client - Getting provider review stats:",e),this.client.get(`/reviews/provider/${e}/stats`)}async canReviewCase(e){return console.log("❓ API Client - Checking if can review case:",e),this.client.get(`/reviews/case/${e}/can-review`)}async getPendingReviews(){return console.log("⏳ API Client - Getting pending reviews"),this.client.get("/reviews/pending")}}let n=new a,o=n},9468:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u,metadata:()=>d});var r=s(9510),a=s(5317),n=s.n(a);s(5023),s(9912);var o=s(8570);let i=(0,o.createProxy)(String.raw`/var/www/servicetextpro/Marketplace/src/app/providers.tsx#Providers`),l=(0,o.createProxy)(String.raw`/var/www/servicetextpro/Marketplace/src/components/GDPRPopup.tsx#default`),c=(0,o.createProxy)(String.raw`/var/www/servicetextpro/Marketplace/src/components/ChatWidget.tsx#default`),d={title:"ServiceText Pro Marketplace",description:"Намерете най-добрите професионалисти в България - електротехници, водопроводчици, климатици",keywords:"електротехник, водопроводчик, климатик, майстор, България, София"};function u({children:e}){return r.jsx("html",{lang:"bg",children:r.jsx("body",{className:n().className,children:(0,r.jsxs)(i,{children:[e,r.jsx(l,{}),r.jsx(c,{})]})})})}},5023:()=>{},9912:()=>{}};