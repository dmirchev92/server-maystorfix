"use strict";exports.id=245,exports.ids=[245],exports.modules={1245:(e,t,s)=>{s.d(t,{Z:()=>n});var l=s(326),i=s(7577),a=s(4001),r=s(8069);function n({isOpen:e,onClose:t,caseId:s,providerId:n,providerName:o,onSubmitSuccess:d}){let{user:c}=(0,a.a)(),[m,x]=(0,i.useState)({rating:0,comment:"",communication:0,quality:0,timeliness:0,valueForMoney:0,wouldRecommend:void 0}),[u,h]=(0,i.useState)(!1),[b,f]=(0,i.useState)(null),p=(e,t,s,l)=>{let i=[e,t,s,l].filter(e=>e>0);return 0===i.length?0:Math.round(i.reduce((e,t)=>e+t,0)/i.length*2)/2},g=({variant:e,size:t=24})=>{let s=Math.random().toString(36).slice(2);return(0,l.jsxs)("svg",{width:t,height:t,viewBox:"0 0 24 24","aria-hidden":"true",className:"inline-block align-middle",children:["half"===e&&l.jsx("defs",{children:(0,l.jsxs)("linearGradient",{id:`half-${s}`,x1:"0",x2:"1",y1:"0",y2:"0",children:[l.jsx("stop",{offset:"50%",stopColor:"#fbbf24"}),l.jsx("stop",{offset:"50%",stopColor:"#64748b"})]})}),l.jsx("path",{d:"M12 .587l3.668 7.429 8.2 1.192-5.934 5.786 1.402 8.173L12 18.896l-7.336 3.871 1.402-8.173L.132 9.208l8.2-1.192L12 .587z",fill:"full"===e?"#fbbf24":"half"===e?`url(#half-${s})`:"#64748b"})]})},j=(e,t)=>{x(s=>{let l={...s,[e]:t};if("rating"!==e){let i="communication"===e?t:s.communication||0,a=p(i,"quality"===e?t:s.quality||0,"timeliness"===e?t:s.timeliness||0,"valueForMoney"===e?t:s.valueForMoney||0);l.rating=a}return l})},v=(e,t)=>(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(s=>{let i=s<=t;return l.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),j(e,s)},className:"transition-transform duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-50 rounded",title:`Оценка ${s} от 5`,children:l.jsx(g,{variant:i?"full":"empty"})},s)}),t>0&&(0,l.jsxs)("span",{className:"ml-2 text-sm text-slate-400",children:[t,"/5"]})]}),y=async e=>{if(e.preventDefault(),0===m.rating){f("Моля поставете поне една оценка от категориите по-долу");return}if(c?.id===n){f("❌ Грешка: Не можете да оставите оценка за себе си като специалист.");return}h(!0),f(null);try{let e={caseId:s,providerId:n,rating:m.rating,comment:m.comment,communication:m.communication||void 0,serviceQuality:m.quality||void 0,timeliness:m.timeliness||void 0,valueForMoney:m.valueForMoney||void 0,wouldRecommend:m.wouldRecommend};await r.x.createReview(e),d?.(),t()}catch(t){console.error("Error submitting survey:",t);let e=t.response?.data?.error?.message||t.response?.data?.message||t.message;t.response?.status===409||e?.includes("already exists")?f("Вие вече сте оценили тази услуга. Не можете да изпратите повторна оценка."):f(e||"Възникна грешка при изпращането на оценката")}finally{h(!1)}};return e?l.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:l.jsx("div",{className:"bg-slate-800/95 backdrop-blur-md border border-white/10 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsxs)("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-white",children:"Оценете услугата"}),(0,l.jsxs)("p",{className:"text-slate-300 mt-1",children:["Как оценявате работата на ",o,"?"]})]}),l.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white text-2xl transition-colors",children:"✕"})]}),b&&l.jsx("div",{className:"bg-red-500/20 border border-red-400/30 rounded-lg p-4 mb-6",children:l.jsx("p",{className:"text-red-300",children:b})}),(0,l.jsxs)("form",{onSubmit:y,className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-lg font-semibold text-white mb-3",children:["Обща оценка ",l.jsx("span",{className:"text-red-400",children:"*"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[l.jsx("div",{className:"flex space-x-1",children:(e=>{let t=[],s=Math.floor(e),i=1e-9>Math.abs(e-s-.5);for(let e=1;e<=5;e++)e<=s?t.push(l.jsx(g,{variant:"full"},e)):e===s+1&&i?t.push(l.jsx(g,{variant:"half"},e)):t.push(l.jsx(g,{variant:"empty"},e));return t})(m.rating)}),l.jsx("span",{className:"ml-2 text-lg font-medium text-slate-200",children:m.rating>0?`${m.rating}/5`:"Не е оценено"})]}),l.jsx("p",{className:"text-sm text-indigo-400 mt-2",children:"Общата оценка се изчислява автоматично като средна стойност (с половин звезди)"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Комуникация"}),v("communication",m.communication||0)]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Качество на работата"}),v("quality",m.quality||0)]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Спазване на срокове"}),v("timeliness",m.timeliness||0)]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Съотношение цена/качество"}),v("valueForMoney",m.valueForMoney||0)]})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-3",children:"Бихте ли препоръчали този специалист?"}),(0,l.jsxs)("div",{className:"flex space-x-4",children:[l.jsx("button",{type:"button",onClick:()=>x(e=>({...e,wouldRecommend:!0})),className:`px-4 py-2 rounded-lg border transition-colors ${!0===m.wouldRecommend?"bg-green-500/20 border-green-400/50 text-green-300":"border-white/20 text-slate-300 hover:bg-white/10"}`,children:"\uD83D\uDC4D Да"}),l.jsx("button",{type:"button",onClick:()=>x(e=>({...e,wouldRecommend:!1})),className:`px-4 py-2 rounded-lg border transition-colors ${!1===m.wouldRecommend?"bg-red-500/20 border-red-400/50 text-red-300":"border-white/20 text-slate-300 hover:bg-white/10"}`,children:"\uD83D\uDC4E Не"})]})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:"Коментар (по желание)"}),l.jsx("textarea",{value:m.comment,onChange:e=>x(t=>({...t,comment:e.target.value})),rows:4,className:"w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all",placeholder:"Споделете вашето мнение за услугата..."})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-white/10",children:[l.jsx("button",{type:"button",onClick:t,disabled:u,className:"px-6 py-2 text-slate-300 bg-slate-700 rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:"Отказ"}),l.jsx("button",{type:"submit",disabled:u||0===m.rating,className:"px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-indigo-500/30",children:u?"Изпращане...":"Изпрати оценка"})]})]})]})})}):null}}};