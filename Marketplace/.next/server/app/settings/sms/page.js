(()=>{var e={};e.id=296,e.ids=[296],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},8893:e=>{"use strict";e.exports=require("buffer")},1282:e=>{"use strict";e.exports=require("child_process")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},1227:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c}),t(8469),t(9468),t(5866);var r=t(3191),a=t(8716),i=t(7922),l=t.n(i),n=t(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);t.d(s,o);let c=["",{children:["settings",{children:["sms",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,8469)),"/var/www/servicetextpro/Marketplace/src/app/settings/sms/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,9468)),"/var/www/servicetextpro/Marketplace/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/var/www/servicetextpro/Marketplace/src/app/settings/sms/page.tsx"],u="/settings/sms/page",x={require:t,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/settings/sms/page",pathname:"/settings/sms",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7907:(e,s,t)=>{Promise.resolve().then(t.bind(t,2484))},2484:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var r=t(326),a=t(7577),i=t(4001),l=t(5047),n=t(5329),o=t(9837),c=t(872);function d(){let{user:e,isAuthenticated:s,isLoading:t}=(0,i.a)();(0,l.useRouter)();let[d,u]=(0,a.useState)(!0),[x,h]=(0,a.useState)(!1),[m,g]=(0,a.useState)({isEnabled:!1,message:"Зает съм, ще върна обаждане след няколко минути.\n\nЗапочнете чат тук:\n[chat_link]\n\n",sentCount:0,filterKnownContacts:!0,processedCalls:0}),[p,f]=(0,a.useState)(""),[b,j]=(0,a.useState)(""),[D,w]=(0,a.useState)({todayCount:0,thisHourCount:0,totalCount:0}),v=async()=>{try{u(!0);let s=await fetch("https://maystorfix.com/api/v1/sms/config",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});if(s.ok){let t=await s.json();if(console.log("\uD83D\uDD0D SMS Config loaded:",t),console.log("\uD83D\uDD0D User ID:",e?.id),console.log("\uD83D\uDD0D Config userChatLinks:",t.data?.config?.userChatLinks),t.success){g(t.data.config),f(t.data.config.message);let s=t.data.config.message;if(console.log("\uD83D\uDD0D Original message:",s),t.data.config.userChatLinks&&e?.id){console.log("\uD83D\uDD0D Looking for user chat link...");let r=t.data.config.userChatLinks[e.id];console.log("\uD83D\uDD0D User link object:",r),r&&r.link?(s=s.replace("[chat_link]",r.link),console.log("✅ Replaced [chat_link] with actual link:",r.link),console.log("✅ Preview text:",s)):(console.log("⚠️ No chat link found for user:",e.id),console.log("⚠️ Available user IDs:",Object.keys(t.data.config.userChatLinks)))}else console.log("⚠️ No userChatLinks in config or no user ID");j(s),w(t.data.stats||{todayCount:0,thisHourCount:0,totalCount:0})}}else console.warn("Failed to load SMS config, using defaults")}catch(e){console.error("Error loading SMS config:",e)}finally{u(!1)}},N=async e=>{try{h(!0);let s=await fetch("https://maystorfix.com/api/v1/sms/config",{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"},body:JSON.stringify(e)});s.ok&&(await s.json()).success?(g(s=>({...s,...e})),alert("SMS настройките са запазени успешно!")):alert("Грешка при запазване на настройките")}catch(e){console.error("Error updating SMS config:",e),alert("Грешка при запазване на настройките")}finally{h(!1)}},S=async()=>{await N({isEnabled:!m.isEnabled})},y=async()=>{if(!p.trim()){alert("Съобщението не може да бъде празно");return}await N({message:p.trim()})},k=async()=>{await N({filterKnownContacts:!m.filterKnownContacts})},C=async()=>{try{h(!0);let s=localStorage.getItem("auth_token");if(console.log("\uD83D\uDD17 Generating new chat link for user:",e?.id),console.log("\uD83D\uDD17 Auth token available:",!!s),console.log("\uD83D\uDD17 User object:",e),!s){alert("Не сте влезли в системата. Моля влезте отново.");return}let t="https://maystorfix.com/api/v1/chat/tokens/regenerate";console.log("\uD83D\uDD17 Making request to:",t);let r=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(console.log("\uD83D\uDD17 Token generation response:",{status:r.status,statusText:r.statusText,headers:Object.fromEntries(r.headers.entries())}),r.ok){let e=await r.json();if(console.log("\uD83D\uDD17 Token generation result:",e),e.success){let s=e.data?.chatUrl;if(console.log("\uD83D\uDD17 Generated chat URL:",s),alert(`Нова чат връзка е генерирана успешно!

Връзка: ${s||"Проверете конзолата за детайли"}

Токен: ${e.data?.token?.substring(0,4)}****`),s){let e=p.replace("[chat_link]",s);j(e)}v()}else console.error("\uD83D\uDD17 Token generation failed:",e),alert("Грешка при генериране на нова връзка: "+(e.error?.message||"Неизвестна грешка"))}else{let e=await r.text();console.error("\uD83D\uDD17 Token generation failed:",{status:r.status,statusText:r.statusText,errorText:e}),alert(`Грешка при генериране на нова връзка: ${r.status} ${r.statusText}

Детайли: ${e}`)}}catch(e){console.error("\uD83D\uDD17 Error generating new link:",e),alert("Грешка при генериране на нова връзка: "+(e?.message||"Неизвестна грешка"))}finally{h(!1)}},M=async()=>{if(confirm("Сигурни ли сте, че искате да изчистите историята на SMS? Само НОВИ пропуснати обаждания ще получават SMS след това."))try{h(!0),(await fetch("https://maystorfix.com/api/v1/sms/history/clear",{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}})).ok?(alert("Историята на SMS е изчистена успешно!"),v()):alert("Грешка при изчистване на историята")}catch(e){console.error("Error clearing SMS history:",e),alert("Грешка при изчистване на историята")}finally{h(!1)}};return d?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Зареждане на SMS настройки..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900",children:[r.jsx(c.Header,{}),(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-white",children:"SMS Настройки"}),r.jsx("p",{className:"mt-2 text-slate-300",children:"Управлявайте автоматичните SMS съобщения за пропуснати обаждания"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,r.jsxs)(n.Zb,{children:[r.jsx(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center",children:[r.jsx("span",{className:"text-2xl mr-2",children:"\uD83D\uDCF1"}),"SMS Статус"]})}),r.jsx(n.aY,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-white",children:"Автоматични SMS"}),r.jsx("p",{className:"text-slate-300",children:m.isEnabled?"Включени - SMS ще се изпращат при пропуснати обаждания":"Изключени - няма да се изпращат SMS"})]}),r.jsx("button",{onClick:S,disabled:x,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${m.isEnabled?"bg-indigo-600":"bg-gray-200"}`,children:r.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m.isEnabled?"translate-x-6":"translate-x-1"}`})})]})})]}),(0,r.jsxs)(n.Zb,{children:[r.jsx(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center",children:[r.jsx("span",{className:"text-2xl mr-2",children:"✏️"}),"SMS Шаблон"]})}),(0,r.jsxs)(n.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Съобщение за SMS"}),r.jsx("textarea",{value:p,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-white placeholder-slate-400",rows:4,placeholder:"Зает съм, ще върна обаждане след няколко минути.\\n\\nЗапочнете чат тук:\\n[chat_link]\\n\\n"}),r.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"\uD83D\uDCA1 Използвайте [chat_link] където искате да се появи автоматично обновяващата се чат връзка"})]}),(0,r.jsxs)("div",{className:"bg-indigo-500/10 border-l-4 border-indigo-400/50 p-4 rounded backdrop-blur-sm",children:[r.jsx("h4",{className:"text-sm font-medium text-indigo-300 mb-2",children:"\uD83D\uDCF1 Преглед на SMS:"}),r.jsx("p",{className:"text-sm text-indigo-200 whitespace-pre-wrap",children:b||"Зареждане на преглед..."}),r.jsx("p",{className:"text-xs text-indigo-300 mt-2 italic",children:"Това е съобщението, което клиентите ще получат"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:y,disabled:x,className:"flex-1 bg-white/20 backdrop-blur-sm text-white hover:bg-white/30 border border-white/30 rounded-md px-4 py-2 font-medium transition-colors disabled:opacity-50",children:x?"Запазване...":"Обнови Шаблон"}),r.jsx("button",{onClick:C,disabled:x,className:"bg-green-500/20 backdrop-blur-sm border border-green-400/30 text-green-300 hover:bg-green-500/30 rounded-md px-4 py-2 font-medium transition-colors disabled:opacity-50",children:"\uD83D\uDD04 Нова Връзка"})]})]})]}),(0,r.jsxs)(n.Zb,{children:[r.jsx(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center",children:[r.jsx("span",{className:"text-2xl mr-2",children:"\uD83D\uDC65"}),"Филтриране на Контакти"]})}),r.jsx(n.aY,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-white",children:"Филтрирай познати контакти"}),r.jsx("p",{className:"text-slate-300",children:m.filterKnownContacts?"Включено - SMS ще се изпращат само на непознати номера":"Изключено - SMS ще се изпращат на всички номера"})]}),r.jsx("button",{onClick:k,disabled:x,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${m.filterKnownContacts?"bg-indigo-600":"bg-gray-200"}`,children:r.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m.filterKnownContacts?"translate-x-6":"translate-x-1"}`})})]})})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(n.Zb,{children:[r.jsx(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center",children:[r.jsx("span",{className:"text-2xl mr-2",children:"\uD83D\uDCCA"}),"Статистики"]})}),(0,r.jsxs)(n.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,r.jsxs)("div",{className:"bg-white/10 p-3 rounded-lg border border-white/20",children:[r.jsx("div",{className:"text-2xl font-bold text-indigo-400",children:m.sentCount}),r.jsx("div",{className:"text-sm text-slate-300",children:"Общо изпратени SMS"})]}),(0,r.jsxs)("div",{className:"bg-white/10 p-3 rounded-lg border border-white/20",children:[r.jsx("div",{className:"text-2xl font-bold text-green-400",children:D.todayCount}),r.jsx("div",{className:"text-sm text-slate-300",children:"Днес"})]}),(0,r.jsxs)("div",{className:"bg-white/10 p-3 rounded-lg border border-white/20",children:[r.jsx("div",{className:"text-2xl font-bold text-orange-400",children:m.processedCalls}),r.jsx("div",{className:"text-sm text-slate-300",children:"Обработени обаждания"})]})]}),m.lastSentTime&&(0,r.jsxs)("div",{className:"text-sm text-slate-300",children:[r.jsx("strong",{children:"Последно SMS:"}),r.jsx("br",{}),new Date(m.lastSentTime).toLocaleString("bg-BG")]})]})]}),(0,r.jsxs)(n.Zb,{children:[r.jsx(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center",children:[r.jsx("span",{className:"text-2xl mr-2",children:"\uD83D\uDEE0️"}),"Действия"]})}),(0,r.jsxs)(n.aY,{className:"space-y-3",children:[r.jsx(o.z,{onClick:M,disabled:x,variant:"outline",className:"w-full bg-red-500/10 border-red-400/30 text-red-300 hover:bg-red-500/20",children:"\uD83D\uDDD1️ Изчисти История"}),r.jsx("p",{className:"text-xs text-slate-400",children:"Изчистване на историята ще позволи SMS да се изпращат отново на номера, които вече са получавали SMS"})]})]}),(0,r.jsxs)(n.Zb,{children:[r.jsx(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"flex items-center",children:[r.jsx("span",{className:"text-2xl mr-2",children:"\uD83D\uDCA1"}),"Помощ"]})}),(0,r.jsxs)(n.aY,{className:"space-y-2 text-sm text-slate-300",children:[r.jsx("p",{children:"• SMS се изпращат автоматично при пропуснати обаждания"}),r.jsx("p",{children:"• Всеки номер получава SMS само веднъж на 5 дни"}),r.jsx("p",{children:"• Чат връзката се обновява автоматично при всяко използване"}),r.jsx("p",{children:"• Можете да тествате настройките от мобилното приложение"})]})]})]})]})]})]})}},5329:(e,s,t)=>{"use strict";t.d(s,{Ol:()=>o,Zb:()=>n,aY:()=>d,ll:()=>c});var r=t(326),a=t(7577),i=t.n(a),l=t(1223);let n=i().forwardRef(({className:e,variant:s="default",padding:t="md",hover:a=!1,children:i,...n},o)=>{let c=`
      rounded-xl transition-all duration-300 ease-in-out
      ${a?"hover:scale-[1.02] hover:shadow-xl cursor-pointer":""}
    `,d={default:`
        bg-white/10 backdrop-blur-md border border-white/20 shadow-lg
        hover:shadow-xl hover:bg-white/15
      `,elevated:`
        bg-white/10 backdrop-blur-md shadow-xl hover:shadow-2xl
        border border-white/20 hover:border-white/30
      `,glass:`
        bg-white/10 backdrop-blur-md border border-white/20
        shadow-lg hover:shadow-xl hover:bg-white/20
      `,gradient:`
        bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-md
        border border-white/20 shadow-lg
        hover:from-white/15 hover:to-white/10 hover:shadow-xl
      `,outline:`
        bg-transparent border-2 border-white/30
        hover:border-white/50 hover:bg-white/10
      `};return r.jsx("div",{className:(0,l.cn)(c,d[s],{none:"",sm:"p-4",md:"p-6",lg:"p-8",xl:"p-10"}[t],e),ref:o,...n,children:i})});n.displayName="Card";let o=i().forwardRef(({className:e,children:s,...t},a)=>r.jsx("div",{ref:a,className:(0,l.cn)("flex flex-col space-y-1.5 pb-4",e),...t,children:s}));o.displayName="CardHeader";let c=i().forwardRef(({className:e,children:s,...t},a)=>r.jsx("h3",{ref:a,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight text-white",e),...t,children:s}));c.displayName="CardTitle",i().forwardRef(({className:e,children:s,...t},a)=>r.jsx("p",{ref:a,className:(0,l.cn)("text-sm text-slate-300",e),...t,children:s})).displayName="CardDescription";let d=i().forwardRef(({className:e,children:s,...t},a)=>r.jsx("div",{ref:a,className:(0,l.cn)("",e),...t,children:s}));d.displayName="CardContent",i().forwardRef(({className:e,children:s,...t},a)=>r.jsx("div",{ref:a,className:(0,l.cn)("flex items-center pt-4",e),...t,children:s})).displayName="CardFooter"},8469:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`/var/www/servicetextpro/Marketplace/src/app/settings/sms/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[276,867,325,673,872],()=>t(1227));module.exports=r})();