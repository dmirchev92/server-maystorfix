(()=>{var e={};e.id=929,e.ids=[929],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},8893:e=>{"use strict";e.exports=require("buffer")},1282:e=>{"use strict";e.exports=require("child_process")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},4885:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>a.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>u,tree:()=>c}),t(4356),t(9468),t(5866);var r=t(3191),l=t(8716),i=t(7922),a=t.n(i),n=t(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);t.d(s,o);let c=["",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,4356)),"/var/www/servicetextpro/Marketplace/src/app/chat/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,9468)),"/var/www/servicetextpro/Marketplace/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/var/www/servicetextpro/Marketplace/src/app/chat/page.tsx"],x="/chat/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/chat/page",pathname:"/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8082:(e,s,t)=>{Promise.resolve().then(t.bind(t,7486))},7486:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var r=t(326),l=t(7577),i=t(7293),a=t(4001);function n({conversations:e,activeConversationId:s,onSelectConversation:t,loading:l=!1}){let{user:i}=(0,a.a)(),n=e=>{let s=new Date(e),t=new Date().getTime()-s.getTime(),r=Math.floor(t/6e4),l=Math.floor(t/36e5),i=Math.floor(t/864e5);return r<1?"Сега":r<60?`${r} мин`:l<24?`${l} ч`:i<7?`${i} д`:s.toLocaleDateString("bg-BG",{day:"numeric",month:"short"})};return l?r.jsx("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 text-gray-500",children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r.jsx("span",{children:"Зареждане..."})]})}):0===e.length?r.jsx("div",{className:"flex items-center justify-center h-full text-center p-8",children:(0,r.jsxs)("div",{className:"text-gray-500",children:[r.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),r.jsx("p",{className:"text-lg font-medium",children:"Няма разговори"}),r.jsx("p",{className:"text-sm mt-1",children:"Започнете нов разговор с доставчик"})]})}):r.jsx("div",{className:"h-full overflow-y-auto bg-white",children:e.map(e=>{let l=e.id===s,a=(e.unreadCount||0)>0,o=i?.role==="customer"?e.providerBusinessName||e.providerName||"Майстор":e.customerName||"Клиент",c=o.charAt(0).toUpperCase(),d=i?.role==="customer"&&e.providerServiceCategory;return(0,r.jsxs)("button",{onClick:()=>t(e.id),className:`
              group w-full p-4 rounded-lg border border-transparent text-left relative transition-all
              hover:bg-white hover:shadow-sm hover:border-purple-200
              ${l?"bg-gradient-to-r from-purple-100 to-indigo-100":""}
              ${a&&!l?"bg-purple-50/40":""}
            `,children:[r.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 rounded-l-lg transition-colors ${l?"bg-purple-600":a?"bg-purple-500":"bg-transparent"} group-hover:bg-purple-400`}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"relative flex-shrink-0",children:r.jsx("div",{className:`
                  w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shadow-md
                  ${l?"bg-gradient-to-br from-purple-600 to-indigo-700":"bg-gradient-to-br from-purple-500 to-indigo-600"}
                `,children:c})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[r.jsx("h3",{className:`font-semibold text-sm truncate ${a||l?"text-gray-900":"text-gray-800"}`,children:o}),d&&(0,r.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full border border-purple-300 text-purple-700 bg-white text-[11px] font-medium flex-shrink-0 group-hover:border-purple-400 group-hover:bg-purple-50",children:[r.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})}),e.providerServiceCategory]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[r.jsx("span",{className:"text-[11px] text-gray-400",children:n(e.lastMessageAt)}),a&&r.jsx("span",{className:"inline-flex items-center justify-center min-w-5 h-5 px-1.5 rounded-full bg-purple-600 text-white text-[10px] font-bold",children:e.unreadCount})]})]}),r.jsx("div",{className:"mt-1 flex items-center justify-between gap-2",children:r.jsx("p",{className:`text-sm truncate flex-1 ${a?"font-medium text-gray-700":"text-gray-500"}`,children:e.lastMessage?.body||"Няма съобщения"})}),e.customerEmail&&r.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:e.customerEmail})]})]})]},e.id)})})}var o=t(5666);function c({messages:e,loading:s=!1,onLoadMore:t,hasMore:i=!1}){let a=(0,l.useRef)(null),n=(0,l.useRef)(null);return((0,l.useRef)(e.length),0!==e.length||s)?(0,r.jsxs)("div",{ref:n,onScroll:()=>{if(!n.current||!t||!i||s)return;let{scrollTop:e}=n.current;0===e&&t()},className:"flex-1 overflow-y-auto bg-gray-50 p-4 space-y-2",children:[i&&r.jsx("div",{className:"text-center py-2",children:s?(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 text-sm text-gray-500",children:[(0,r.jsxs)("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r.jsx("span",{children:"Зареждане..."})]}):r.jsx("button",{onClick:t,className:"text-sm text-purple-600 hover:text-purple-700 font-medium",children:"Зареди по-стари съобщения"})}),e.map((s,t)=>{let l=0===t||e[t-1].senderUserId!==s.senderUserId;return r.jsx(o.Z,{message:s,showSenderName:l},s.id)}),s&&0===e.length&&r.jsx("div",{className:"flex items-center justify-center py-8",children:(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 text-gray-500",children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r.jsx("span",{children:"Зареждане на съобщения..."})]})}),r.jsx("div",{ref:a})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[r.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),r.jsx("p",{className:"text-lg font-medium",children:"Няма съобщения"}),r.jsx("p",{className:"text-sm mt-1",children:"Започнете разговор като изпратите съобщение"})]})})}function d({onSend:e,disabled:s=!1,placeholder:t="Напишете съобщение..."}){let[i,a]=(0,l.useState)(""),n=(0,l.useRef)(null),o=()=>{let t=i.trim();t&&!s&&(e(t),a(""),n.current&&(n.current.style.height="auto"))};return(0,r.jsxs)("div",{className:"border-t border-gray-200 bg-white p-4",children:[(0,r.jsxs)("div",{className:"flex items-end gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[r.jsx("textarea",{ref:n,value:i,onChange:e=>{a(e.target.value);let s=e.target;s.style.height="auto",s.style.height=Math.min(s.scrollHeight,150)+"px"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o())},placeholder:t,disabled:s,rows:1,className:" w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm ",style:{maxHeight:"150px"}}),i.length>0&&(0,r.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-gray-400",children:[i.length,"/10000"]})]}),(0,r.jsxs)("button",{onClick:o,disabled:s||!i.trim(),className:" px-6 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium hover:from-purple-700 hover:to-indigo-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 ",children:[r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),r.jsx("span",{className:"hidden sm:inline",children:"Изпрати"})]})]}),r.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Натиснете Enter за изпращане, Shift+Enter за нов ред"})]})}function x({conversationId:e}){let{user:s}=(0,a.a)(),{messages:t,loading:l,loadMessages:n,sendMessage:o,markAsRead:x,conversations:m}=(0,i.R)(),u=m.find(s=>s.id===e),h=t[e]||[],p=async s=>{await o(e,s),x(e)};return u?(0,r.jsxs)("div",{className:"flex-1 flex flex-col h-full",children:[r.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s?.role==="customer"?u.providerBusinessName||u.providerName||"Майстор":u.customerName||"Клиент"}),s?.role==="customer"&&u.providerServiceCategory?r.jsx("p",{className:"text-sm text-gray-500",children:u.providerServiceCategory}):r.jsx("p",{className:"text-sm text-gray-500",children:u.customerEmail})]}),r.jsx("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{children:"Свързан"})]})})]})}),r.jsx(c,{messages:h,loading:l}),r.jsx(d,{onSend:p,disabled:l})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[r.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),r.jsx("p",{className:"text-lg font-medium",children:"Изберете разговор"}),r.jsx("p",{className:"text-sm mt-1",children:"Изберете разговор от списъка вляво"})]})})}function m(){let{conversations:e,activeConversationId:s,setActiveConversation:t,loading:a}=(0,i.R)(),[o,c]=(0,l.useState)(!1);return(0,r.jsxs)("div",{className:"h-screen flex flex-col bg-gray-100",children:[r.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-6 py-4 shadow-lg",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[o&&r.jsx("button",{onClick:()=>{c(!1),t(null)},className:"md:hidden p-2 hover:bg-white/10 rounded-lg transition",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Съобщения"}),(0,r.jsxs)("p",{className:"text-sm text-purple-100",children:[e.length," ",1===e.length?"разговор":"разговора"]})]})]}),r.jsx("button",{onClick:()=>window.location.reload(),className:"p-2 hover:bg-white/10 rounded-lg transition",title:"Обнови",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})}),(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[r.jsx("div",{className:`
          w-full md:w-96 border-r border-gray-200 bg-white
          ${o?"hidden md:block":"block"}
        `,children:r.jsx(n,{conversations:e,activeConversationId:s,onSelectConversation:e=>{t(e),c(!0)},loading:a})}),r.jsx("div",{className:`
          flex-1 bg-gray-50
          ${o?"block":"hidden md:block"}
        `,children:s?r.jsx(x,{conversationId:s}):r.jsx("div",{className:"h-full flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[r.jsx("svg",{className:"w-24 h-24 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),r.jsx("p",{className:"text-xl font-medium mb-2",children:"Добре дошли в съобщенията"}),r.jsx("p",{className:"text-sm",children:"Изберете разговор от списъка вляво за да започнете"})]})})})]})]})}var u=t(5047);function h(){let{isAuthenticated:e,isLoading:s}=(0,a.a)();return((0,u.useRouter)(),(0,u.useSearchParams)().get("conversation"),s)?r.jsx("div",{className:"h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 text-gray-500",children:[(0,r.jsxs)("svg",{className:"animate-spin h-8 w-8",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r.jsx("span",{children:"Зареждане..."})]})}):e?r.jsx(m,{}):null}function p(){return r.jsx(l.Suspense,{fallback:r.jsx("div",{className:"h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 text-gray-500",children:[(0,r.jsxs)("svg",{className:"animate-spin h-8 w-8",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r.jsx("span",{children:"Зареждане..."})]})}),children:r.jsx(h,{})})}},4356:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`/var/www/servicetextpro/Marketplace/src/app/chat/page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[276,867,673],()=>t(4885));module.exports=r})();