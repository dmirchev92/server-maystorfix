(()=>{var e={};e.id=193,e.ids=[193],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},8893:e=>{"use strict";e.exports=require("buffer")},1282:e=>{"use strict";e.exports=require("child_process")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},1690:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>l}),s(3468),s(9468),s(5866);var r=s(3191),a=s(8716),i=s(7922),o=s.n(i),n=s(5231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);s.d(t,c);let l=["",{children:["notifications",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3468)),"/var/www/servicetextpro/Marketplace/src/app/notifications/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9468)),"/var/www/servicetextpro/Marketplace/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/var/www/servicetextpro/Marketplace/src/app/notifications/page.tsx"],u="/notifications/page",x={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/notifications/page",pathname:"/notifications",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},5713:(e,t,s)=>{Promise.resolve().then(s.bind(s,6130))},6130:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(326),a=s(7577),i=s(4001),o=s(5047),n=s(8069),c=s(872);function l(){let{user:e,isAuthenticated:t,isLoading:s}=(0,i.a)(),l=(0,o.useRouter)(),[d,u]=(0,a.useState)([]),[x,p]=(0,a.useState)(!0),[m,h]=(0,a.useState)(null),g=async()=>{try{p(!0),console.log("\uD83D\uDD14 Fetching notifications for user:",e?.id);let t=await n.x.getUserNotifications();if(console.log("\uD83D\uDD14 Notifications API response:",t),t.data?.success){let e=t.data.data?.notifications||[];console.log("\uD83D\uDD14 Notifications data:",e);let s=[...e].sort((e,t)=>{let s=new Date(e.created_at).getTime();return new Date(t.created_at).getTime()-s});console.log("\uD83D\uDD14 Sorted notifications (newest first):",s.map(e=>({id:e.id.substring(0,8),created_at:e.created_at,title:e.title}))),u(s)}else console.error("\uD83D\uDD14 API returned unsuccessful response:",t.data),h("Грешка при зареждането на известията")}catch(e){console.error("\uD83D\uDD14 Error fetching notifications:",e),console.error("\uD83D\uDD14 Error details:",{message:e.message,status:e.response?.status,statusText:e.response?.statusText,data:e.response?.data}),e.response?.status===401||e.response?.status===403?(console.log("\uD83D\uDD14 Authentication error detected, but not redirecting to avoid loop"),h("Сесията ви е изтекла. Моля влезте отново в профила си.")):e.response?.status===404?(console.log("\uD83D\uDD14 Notifications endpoint not found, showing empty state"),u([])):h(`Възникна грешка при зареждането на известията: ${e.message}`)}finally{p(!1)}},f=async e=>{try{await n.x.markNotificationAsRead(e),u(t=>t.map(t=>t.id===e?{...t,read:!0}:t))}catch(e){console.error("Error marking notification as read:",e)}},b=async()=>{try{await n.x.markAllNotificationsAsRead(),u(e=>e.map(e=>({...e,read:!0})))}catch(e){console.error("Error marking all notifications as read:",e)}},v=async e=>{if(e.read||await f(e.id),"case_completed"===e.type&&e.data?.action==="review_service"){let t=e.data?.caseId;t&&l.push(`/survey/${t}`)}else if("case_assigned"===e.type){let t=e.data?.caseId;t&&console.log("\uD83D\uDD14 Navigating to case:",t),l.push("/dashboard/cases")}else"case_accepted"===e.type?l.push("/dashboard"):"new_case_available"===e.type&&l.push("/dashboard?view=available")},D=e=>{switch(e){case"case_completed":return"\uD83C\uDF1F";case"case_assigned":return"\uD83D\uDCEC";case"case_accepted":return"✅";case"case_declined":return"❌";case"new_case_available":return"\uD83D\uDCCB";default:return"\uD83D\uDCE2"}},w=e=>{switch(e){case"case_completed":return"from-yellow-500/10 to-orange-500/10 border-yellow-400/30";case"case_assigned":return"from-indigo-500/10 to-purple-500/10 border-indigo-400/30";case"case_accepted":return"from-green-500/10 to-emerald-500/10 border-green-400/30";case"case_declined":return"from-red-500/10 to-pink-500/10 border-red-400/30";case"new_case_available":return"from-blue-500/10 to-indigo-500/10 border-blue-400/30";case"review_request":return"from-purple-500/10 to-violet-500/10 border-purple-400/30";default:return"from-slate-500/10 to-gray-500/10 border-slate-400/30"}},j=e=>{try{let t=new Date(e),s=new Date;if(isNaN(t.getTime()))return console.error("Invalid date:",e),"Невалидна дата";let r=t.toDateString()===s.toDateString(),a=t.getFullYear()===s.getFullYear();if(r)return t.toLocaleTimeString("bg-BG",{hour:"2-digit",minute:"2-digit",timeZone:"Europe/Sofia"});return t.toLocaleString("bg-BG",{day:"numeric",month:"short",year:a?void 0:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Sofia"})}catch(t){return console.error("Error formatting date:",t,e),"Невалидна дата"}};return s||x?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-white/30 mx-auto"}),r.jsx("p",{className:"mt-4 text-slate-300",children:"Зареждане на известията..."})]})}):m?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"text-6xl mb-4",children:"❌"}),r.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Грешка"}),r.jsx("p",{className:"text-slate-300 mb-4",children:m}),r.jsx("button",{onClick:()=>g(),className:"bg-indigo-600/80 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors",children:"Опитай отново"})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900",children:[r.jsx(c.Header,{}),(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[r.jsx("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"flex items-center space-x-4",children:r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Известия"})}),d.some(e=>!e.read)&&r.jsx("button",{onClick:b,className:"text-indigo-400 hover:text-indigo-300 text-sm font-medium transition-colors",children:"Маркирай всички като прочетени"})]})}),0===d.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("div",{className:"text-6xl mb-4",children:"\uD83D\uDCED"}),r.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Няма известия"}),r.jsx("p",{className:"text-slate-300",children:"Когато получите известия, те ще се появят тук."})]}):r.jsx("div",{className:"space-y-4",children:d.map(e=>r.jsx("div",{onClick:()=>v(e),className:`
                  bg-gradient-to-r ${w(e.type)} 
                  backdrop-blur-md border rounded-lg p-4 cursor-pointer transition-all duration-200 
                  hover:shadow-xl hover:scale-[1.01]
                  ${e.read?"":"ring-2 ring-indigo-400/50"}
                `,children:(0,r.jsxs)("div",{className:"flex items-start space-x-4",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-12 h-12 bg-white/20 border border-white/30 rounded-full flex items-center justify-center shadow-sm",children:r.jsx("span",{className:"text-2xl",children:D(e.type)})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold text-white truncate",children:e.title}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("span",{className:"text-sm text-slate-300",children:j(e.created_at)}),!e.read&&r.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full"})]})]}),r.jsx("p",{className:"text-slate-200 mt-1",children:e.message}),"case_completed"===e.type&&r.jsx("div",{className:"mt-3",children:(0,r.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-500/20 text-yellow-300 border border-yellow-400/30",children:[r.jsx("span",{className:"mr-1",children:"⭐"}),"Натиснете за оценка"]})})]})]})},e.id))})]})]})}},3468:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/var/www/servicetextpro/Marketplace/src/app/notifications/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,867,325,673,872],()=>s(1690));module.exports=r})();