(()=>{var e={};e.id=797,e.ids=[797],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},8893:e=>{"use strict";e.exports=require("buffer")},1282:e=>{"use strict";e.exports=require("child_process")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},6021:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d}),r(4856),r(9468),r(5866);var t=r(3191),a=r(8716),i=r(7922),l=r.n(i),n=r(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(s,o);let d=["",{children:["search",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,4856)),"/var/www/servicetextpro/Marketplace/src/app/search/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9468)),"/var/www/servicetextpro/Marketplace/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/var/www/servicetextpro/Marketplace/src/app/search/page.tsx"],u="/search/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/search/page",pathname:"/search",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2079:(e,s,r)=>{Promise.resolve().then(r.bind(r,6519))},6519:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>x,dynamic:()=>m});var t=r(326),a=r(7577),i=r(5047),l=r(4001),n=r(872),o=r(6158),d=r(5295),c=r(8069),u=r(795);let m="force-dynamic";function x(){let e=(0,i.useSearchParams)(),s=(0,i.useRouter)(),{user:r}=(0,l.a)(),[m,x]=(0,a.useState)([]),[p,h]=(0,a.useState)(!0),[g,b]=(0,a.useState)(null),[v,f]=(0,a.useState)(!1),[j,N]=(0,a.useState)(null),[w,y]=(0,a.useState)(0),[D,_]=(0,a.useState)(null),[C,q]=(0,a.useState)(!1),k=e.get("category"),P=e.get("city"),S=e.get("neighborhood"),[$,E]=(0,a.useState)({category:k||"",city:P||"",neighborhood:S||""}),I=e=>({electrician:"Електротехник",plumber:"Водопроводчик",hvac:"Климатик",carpenter:"Дърводелец",painter:"Бояджия",locksmith:"Ключар",cleaner:"Почистване",gardener:"Градинар",handyman:"Майстор за всичко",appliance_repair:"Ремонт на уреди"})[e]||e,M=e=>{let s=[],r=Math.floor(e);for(let e=0;e<r;e++)s.push("⭐");for(e%1!=0&&s.push("⭐");s.length<5;)s.push("☆");return s.join("")},A=async e=>{try{let t=e.business_name||e.businessName,a=e.first_name||e.firstName,i=e.last_name||e.lastName;t||`${a||""} ${i||""}`.trim();let l=await c.x.createOrGetConversation({providerId:e.id,customerId:r?.id,customerName:r?.firstName+" "+r?.lastName||"Customer",customerEmail:r?.email||"",customerPhone:r?.phoneNumber||""});if(console.log("\uD83D\uDD17 Conversation response:",l.data),l.data?.success){let e=l.data.data?.conversation?.id||l.data.data?.conversationId;e?s.push(`/chat?conversation=${e}`):(console.error("No conversation ID in response:",l.data),s.push("/chat"))}else s.push("/chat")}catch(e){console.error("Error creating conversation:",e),s.push("/chat")}},F=e=>{console.log("Selected provider for case creation:",e),console.log("Provider category:",e.serviceCategory||e.service_category),N(e),f(!0)},G=async e=>{try{let s={...e,customerId:r?.id,providerId:"specific"===e.assignmentType?j?.id:null,providerName:"specific"===e.assignmentType?j?.businessName||j?.business_name||`${j?.first_name||""} ${j?.last_name||""}`.trim()||"Специалист":null,isOpenCase:"open"===e.assignmentType};console.log("Creating case with data:",s);let t=await c.x.createCase(s);if(t.data?.success){f(!1),N(null);let s="specific"===e.assignmentType?`Заявката е изпратена директно към ${j?.businessName||j?.business_name||j?.first_name||"специалиста"}! Ще получите потвърждение скоро.`:"Заявката е създадена и е достъпна за всички специалисти! Ще получите потвърждение скоро.";alert(s)}else throw Error(t.data?.message||"Failed to create case")}catch(e){console.error("Error creating case:",e),alert("Възникна грешка при създаването на заявката. Моля, опитайте отново.")}},T=e=>{E(e);let r=new URLSearchParams;e.category&&r.append("category",e.category),e.city&&r.append("city",e.city),e.neighborhood&&r.append("neighborhood",e.neighborhood),s.push(`/search?${r.toString()}`)};return(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 relative overflow-hidden",children:[(0,t.jsxs)("div",{className:"absolute inset-0",children:[t.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-gradient-to-br from-indigo-500/10 to-slate-500/10 rounded-lg blur-3xl"}),t.jsx("div",{className:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500/10 to-slate-500/10 rounded-lg blur-3xl"})]}),t.jsx(n.Header,{}),(0,t.jsxs)("main",{className:"relative z-10 container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8 bg-white/10 backdrop-blur-md rounded-xl p-6 shadow-xl border border-white/20",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center",children:t.jsx("span",{className:"text-white text-lg",children:"\uD83D\uDD0D"})}),t.jsx("h1",{className:"text-3xl font-bold text-white",children:"Намерени Услуги"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${C?"bg-green-500":"bg-red-500"}`}),t.jsx("span",{className:"text-sm text-slate-300",children:C?"Актуални данни":"Без връзка"}),w>0&&(0,t.jsxs)("span",{className:"bg-indigo-500/20 text-indigo-300 text-xs px-2 py-1 rounded-full border border-indigo-400/30",children:[w," обновления"]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 text-sm",children:[k&&(0,t.jsxs)("span",{className:"bg-indigo-500/20 text-indigo-300 px-3 py-1 rounded-full border border-indigo-400/30",children:["\uD83D\uDCCB ",I(k)]}),P&&(0,t.jsxs)("span",{className:"bg-green-500/20 text-green-300 px-3 py-1 rounded-full border border-green-400/30",children:["\uD83C\uDFD9️ ",P]}),S&&(0,t.jsxs)("span",{className:"bg-purple-500/20 text-purple-300 px-3 py-1 rounded-full border border-purple-400/30",children:["\uD83D\uDCCD ",S]})]})]}),(0,t.jsxs)("div",{className:"mb-8 bg-white/10 backdrop-blur-md rounded-xl p-6 shadow-xl border border-white/20",children:[t.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Филтри за търсене"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Тип услуга"}),(0,t.jsxs)("select",{value:$.category,onChange:e=>T({...$,category:e.target.value}),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"Всички услуги"}),[{value:"electrician",label:"Електротехник"},{value:"plumber",label:"Водопроводчик"},{value:"hvac",label:"Климатик"},{value:"carpenter",label:"Дърводелец"},{value:"painter",label:"Бояджия"},{value:"locksmith",label:"Ключар"},{value:"cleaner",label:"Почистване"},{value:"gardener",label:"Градинар"},{value:"handyman",label:"Майстор за всичко"},{value:"appliance_repair",label:"Ремонт на уреди"}].map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Град"}),(0,t.jsxs)("select",{value:$.city,onChange:e=>T({...$,city:e.target.value,neighborhood:""}),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"Изберете град"}),[{value:"София",label:"София"},{value:"Пловдив",label:"Пловдив"},{value:"Варна",label:"Варна"},{value:"Бургас",label:"Бургас"}].map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})]}),"София"===$.city&&(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Квартал"}),(0,t.jsxs)("select",{value:$.neighborhood,onChange:e=>T({...$,neighborhood:e.target.value}),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"Всички квартали"}),u.vp.map(e=>t.jsx("option",{value:e,children:e},e))]})]})]})]}),p&&(0,t.jsxs)("div",{className:"text-center py-12",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white/30 mx-auto"}),t.jsx("p",{className:"mt-4 text-slate-300",children:"Зареждане на услуги..."})]}),g&&(0,t.jsxs)("div",{className:"bg-red-500/10 border border-red-400/30 rounded-lg p-6 text-center backdrop-blur-sm",children:[(0,t.jsxs)("p",{className:"text-red-300",children:["❌ ",g]}),t.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 bg-red-600/80 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors",children:"Опитай отново"})]}),!p&&!g&&(0,t.jsxs)(t.Fragment,{children:[t.jsx("div",{className:"mb-6 bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-indigo-400",children:"\uD83D\uDCCA"}),(0,t.jsxs)("p",{className:"text-white font-semibold",children:["Намерени ",m.length," ",1===m.length?"услуга":"услуги"]})]})}),0===m.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),t.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Няма намерени услуги"}),t.jsx("p",{className:"text-slate-300 mb-6",children:"Опитайте с различни критерии за търсене"}),t.jsx("a",{href:"/",className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition-all duration-300",children:"Върни се към началото"})]}):t.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:m.map(e=>t.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-xl shadow-xl overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:scale-105 border border-white/20",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[t.jsx("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[e.profileImageUrl?t.jsx("img",{src:e.profileImageUrl,alt:e.businessName,className:"w-12 h-12 rounded-full object-cover border-2 border-white/30"}):t.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 border-2 border-white/30 rounded-full flex items-center justify-center",children:(0,t.jsxs)("span",{className:"text-white text-sm font-bold",children:[e.firstName?.charAt(0),e.lastName?.charAt(0)]})}),(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"text-lg font-bold text-white",children:e.businessName}),(0,t.jsxs)("p",{className:"text-sm text-slate-300 font-medium",children:[e.firstName," ",e.lastName]})]})]})}),t.jsx("span",{className:"bg-gradient-to-r from-indigo-500/20 to-purple-500/20 text-indigo-300 text-xs px-3 py-1 rounded-full font-semibold border border-indigo-400/30",children:I(e.serviceCategory||e.service_category)})]}),(0,t.jsxs)("div",{className:"flex items-center mb-4 p-2 bg-white/10 rounded-lg",children:[t.jsx("span",{className:"text-lg mr-2",children:M(e.rating||0)}),(0,t.jsxs)("span",{className:"text-sm text-slate-200 font-semibold",children:[Number(e.rating||0).toFixed(1)," (",e.totalReviews||e.total_reviews||0," отзива)"]})]}),t.jsx("p",{className:"text-slate-200 text-sm mb-4 line-clamp-3 bg-white/5 p-3 rounded-lg italic",children:e.description||"Професионални услуги с качество и гаранция."}),(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center text-sm text-slate-300",children:[t.jsx("span",{className:"mr-2",children:"\uD83D\uDCCD"}),(0,t.jsxs)("span",{children:[e.city,", ",e.neighborhood]})]}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-slate-300",children:[t.jsx("span",{className:"mr-2",children:"⭐"}),(0,t.jsxs)("span",{children:[e.experienceYears," години опит"]})]}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-slate-300",children:[t.jsx("span",{className:"mr-2",children:"\uD83D\uDCDE"}),t.jsx("span",{children:e.phoneNumber})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx("a",{href:`/provider/${e.id}`,className:"flex-1 bg-white/20 text-white text-center py-2 px-4 rounded-md hover:bg-white/30 transition-colors text-sm font-medium border border-white/30",children:"Виж повече"}),r?.id!==e.id&&(0,t.jsxs)(t.Fragment,{children:[t.jsx("button",{onClick:()=>F(e),className:"bg-purple-600/80 text-white py-2 px-4 rounded-md hover:bg-purple-600 transition-colors text-sm font-medium",children:"Заявка"}),t.jsx("button",{onClick:()=>A(e),className:"bg-indigo-600/80 text-white py-2 px-4 rounded-md hover:bg-indigo-600 transition-colors text-sm font-medium",children:"Чат"})]})]})]})},e.id))})]}),t.jsx("div",{className:"text-center mt-12",children:(0,t.jsxs)("a",{href:"/",className:"inline-flex items-center gap-2 bg-gradient-to-r from-slate-600 to-blue-600 text-white px-6 py-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition-all duration-300 font-medium",children:[t.jsx("span",{children:"\uD83C\uDFE0"}),"Върни се към началото"]})})]}),t.jsx(d.$,{}),j&&t.jsx(o.Z,{isOpen:v,onClose:()=>{f(!1),N(null)},onSubmit:G,providerName:j.businessName||j.business_name||`${j.first_name||""} ${j.last_name||""}`.trim()||"Специалист",providerId:j.id,providerCategory:j.serviceCategory||j.service_category,customerPhone:r?.phoneNumber||"",mode:"direct"})]})}},4856:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>i,dynamic:()=>a});var t=r(8570);let a=(0,t.createProxy)(String.raw`/var/www/servicetextpro/Marketplace/src/app/search/page.tsx#dynamic`),i=(0,t.createProxy)(String.raw`/var/www/servicetextpro/Marketplace/src/app/search/page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[276,867,325,673,872,25],()=>r(6021));module.exports=t})();